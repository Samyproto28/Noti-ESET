"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/news/route";
exports.ids = ["app/api/news/route"];
exports.modules = {

/***/ "next/dist/compiled/next-server/app-page.runtime.dev.js":
/*!*************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-page.runtime.dev.js" ***!
  \*************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-page.runtime.dev.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "crypto":
/*!*************************!*\
  !*** external "crypto" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("crypto");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fnews%2Froute&page=%2Fapi%2Fnews%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fnews%2Froute.ts&appDir=%2Fhome%2Fsamuel%2FEscritorio%2FNoti-ESET%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2Fhome%2Fsamuel%2FEscritorio%2FNoti-ESET&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=standalone&preferredRegion=&middlewareConfig=e30%3D!":
/*!******************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fnews%2Froute&page=%2Fapi%2Fnews%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fnews%2Froute.ts&appDir=%2Fhome%2Fsamuel%2FEscritorio%2FNoti-ESET%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2Fhome%2Fsamuel%2FEscritorio%2FNoti-ESET&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=standalone&preferredRegion=&middlewareConfig=e30%3D! ***!
  \******************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   originalPathname: () => (/* binding */ originalPathname),\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   requestAsyncStorage: () => (/* binding */ requestAsyncStorage),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   staticGenerationAsyncStorage: () => (/* binding */ staticGenerationAsyncStorage)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/future/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(rsc)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var _home_samuel_Escritorio_Noti_ESET_src_app_api_news_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./src/app/api/news/route.ts */ \"(rsc)/./src/app/api/news/route.ts\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"standalone\"\nconst routeModule = new next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/news/route\",\n        pathname: \"/api/news\",\n        filename: \"route\",\n        bundlePath: \"app/api/news/route\"\n    },\n    resolvedPagePath: \"/home/samuel/Escritorio/Noti-ESET/src/app/api/news/route.ts\",\n    nextConfigOutput,\n    userland: _home_samuel_Escritorio_Noti_ESET_src_app_api_news_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { requestAsyncStorage, staticGenerationAsyncStorage, serverHooks } = routeModule;\nconst originalPathname = \"/api/news/route\";\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        serverHooks,\n        staticGenerationAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIuanM/bmFtZT1hcHAlMkZhcGklMkZuZXdzJTJGcm91dGUmcGFnZT0lMkZhcGklMkZuZXdzJTJGcm91dGUmYXBwUGF0aHM9JnBhZ2VQYXRoPXByaXZhdGUtbmV4dC1hcHAtZGlyJTJGYXBpJTJGbmV3cyUyRnJvdXRlLnRzJmFwcERpcj0lMkZob21lJTJGc2FtdWVsJTJGRXNjcml0b3JpbyUyRk5vdGktRVNFVCUyRnNyYyUyRmFwcCZwYWdlRXh0ZW5zaW9ucz10c3gmcGFnZUV4dGVuc2lvbnM9dHMmcGFnZUV4dGVuc2lvbnM9anN4JnBhZ2VFeHRlbnNpb25zPWpzJnJvb3REaXI9JTJGaG9tZSUyRnNhbXVlbCUyRkVzY3JpdG9yaW8lMkZOb3RpLUVTRVQmaXNEZXY9dHJ1ZSZ0c2NvbmZpZ1BhdGg9dHNjb25maWcuanNvbiZiYXNlUGF0aD0mYXNzZXRQcmVmaXg9Jm5leHRDb25maWdPdXRwdXQ9c3RhbmRhbG9uZSZwcmVmZXJyZWRSZWdpb249Jm1pZGRsZXdhcmVDb25maWc9ZTMwJTNEISIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7QUFBc0c7QUFDdkM7QUFDYztBQUNXO0FBQ3hGO0FBQ0E7QUFDQTtBQUNBLHdCQUF3QixnSEFBbUI7QUFDM0M7QUFDQSxjQUFjLHlFQUFTO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSxZQUFZO0FBQ1osQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBLFFBQVEsaUVBQWlFO0FBQ3pFO0FBQ0E7QUFDQSxXQUFXLDRFQUFXO0FBQ3RCO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDdUg7O0FBRXZIIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vbm90aS1lc2V0Lz84NTQyIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEFwcFJvdXRlUm91dGVNb2R1bGUgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9mdXR1cmUvcm91dGUtbW9kdWxlcy9hcHAtcm91dGUvbW9kdWxlLmNvbXBpbGVkXCI7XG5pbXBvcnQgeyBSb3V0ZUtpbmQgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9mdXR1cmUvcm91dGUta2luZFwiO1xuaW1wb3J0IHsgcGF0Y2hGZXRjaCBhcyBfcGF0Y2hGZXRjaCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2xpYi9wYXRjaC1mZXRjaFwiO1xuaW1wb3J0ICogYXMgdXNlcmxhbmQgZnJvbSBcIi9ob21lL3NhbXVlbC9Fc2NyaXRvcmlvL05vdGktRVNFVC9zcmMvYXBwL2FwaS9uZXdzL3JvdXRlLnRzXCI7XG4vLyBXZSBpbmplY3QgdGhlIG5leHRDb25maWdPdXRwdXQgaGVyZSBzbyB0aGF0IHdlIGNhbiB1c2UgdGhlbSBpbiB0aGUgcm91dGVcbi8vIG1vZHVsZS5cbmNvbnN0IG5leHRDb25maWdPdXRwdXQgPSBcInN0YW5kYWxvbmVcIlxuY29uc3Qgcm91dGVNb2R1bGUgPSBuZXcgQXBwUm91dGVSb3V0ZU1vZHVsZSh7XG4gICAgZGVmaW5pdGlvbjoge1xuICAgICAgICBraW5kOiBSb3V0ZUtpbmQuQVBQX1JPVVRFLFxuICAgICAgICBwYWdlOiBcIi9hcGkvbmV3cy9yb3V0ZVwiLFxuICAgICAgICBwYXRobmFtZTogXCIvYXBpL25ld3NcIixcbiAgICAgICAgZmlsZW5hbWU6IFwicm91dGVcIixcbiAgICAgICAgYnVuZGxlUGF0aDogXCJhcHAvYXBpL25ld3Mvcm91dGVcIlxuICAgIH0sXG4gICAgcmVzb2x2ZWRQYWdlUGF0aDogXCIvaG9tZS9zYW11ZWwvRXNjcml0b3Jpby9Ob3RpLUVTRVQvc3JjL2FwcC9hcGkvbmV3cy9yb3V0ZS50c1wiLFxuICAgIG5leHRDb25maWdPdXRwdXQsXG4gICAgdXNlcmxhbmRcbn0pO1xuLy8gUHVsbCBvdXQgdGhlIGV4cG9ydHMgdGhhdCB3ZSBuZWVkIHRvIGV4cG9zZSBmcm9tIHRoZSBtb2R1bGUuIFRoaXMgc2hvdWxkXG4vLyBiZSBlbGltaW5hdGVkIHdoZW4gd2UndmUgbW92ZWQgdGhlIG90aGVyIHJvdXRlcyB0byB0aGUgbmV3IGZvcm1hdC4gVGhlc2Vcbi8vIGFyZSB1c2VkIHRvIGhvb2sgaW50byB0aGUgcm91dGUuXG5jb25zdCB7IHJlcXVlc3RBc3luY1N0b3JhZ2UsIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2UsIHNlcnZlckhvb2tzIH0gPSByb3V0ZU1vZHVsZTtcbmNvbnN0IG9yaWdpbmFsUGF0aG5hbWUgPSBcIi9hcGkvbmV3cy9yb3V0ZVwiO1xuZnVuY3Rpb24gcGF0Y2hGZXRjaCgpIHtcbiAgICByZXR1cm4gX3BhdGNoRmV0Y2goe1xuICAgICAgICBzZXJ2ZXJIb29rcyxcbiAgICAgICAgc3RhdGljR2VuZXJhdGlvbkFzeW5jU3RvcmFnZVxuICAgIH0pO1xufVxuZXhwb3J0IHsgcm91dGVNb2R1bGUsIHJlcXVlc3RBc3luY1N0b3JhZ2UsIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2UsIHNlcnZlckhvb2tzLCBvcmlnaW5hbFBhdGhuYW1lLCBwYXRjaEZldGNoLCAgfTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9YXBwLXJvdXRlLmpzLm1hcCJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fnews%2Froute&page=%2Fapi%2Fnews%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fnews%2Froute.ts&appDir=%2Fhome%2Fsamuel%2FEscritorio%2FNoti-ESET%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2Fhome%2Fsamuel%2FEscritorio%2FNoti-ESET&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=standalone&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./src/app/api/news/route.ts":
/*!***********************************!*\
  !*** ./src/app/api/news/route.ts ***!
  \***********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   GET: () => (/* binding */ GET),\n/* harmony export */   POST: () => (/* binding */ POST)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/./node_modules/next/dist/api/server.js\");\n/* harmony import */ var zod__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! zod */ \"(rsc)/./node_modules/zod/v4/classic/external.js\");\n/* harmony import */ var _lib_supabase__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/lib/supabase */ \"(rsc)/./src/lib/supabase.ts\");\n/* harmony import */ var _lib_rateLimiter__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/lib/rateLimiter */ \"(rsc)/./src/lib/rateLimiter.ts\");\n\n\n\n\n// Zod schema for query parameter validation\nconst newsQuerySchema = zod__WEBPACK_IMPORTED_MODULE_3__.object({\n    page: zod__WEBPACK_IMPORTED_MODULE_3__.coerce.number().min(1).max(1000).default(1),\n    limit: zod__WEBPACK_IMPORTED_MODULE_3__.coerce.number().min(1).max(100).default(20),\n    category: zod__WEBPACK_IMPORTED_MODULE_3__[\"enum\"]([\n        \"national\",\n        \"international\",\n        \"technology\",\n        \"sports\",\n        \"culture\"\n    ]).optional(),\n    author_id: zod__WEBPACK_IMPORTED_MODULE_3__.string().uuid().optional(),\n    start_date: zod__WEBPACK_IMPORTED_MODULE_3__.string().datetime().optional(),\n    end_date: zod__WEBPACK_IMPORTED_MODULE_3__.string().datetime().optional(),\n    search: zod__WEBPACK_IMPORTED_MODULE_3__.string().min(1).max(100).optional(),\n    sort_by: zod__WEBPACK_IMPORTED_MODULE_3__[\"enum\"]([\n        \"published_at\",\n        \"created_at\",\n        \"title\",\n        \"category\"\n    ]).default(\"published_at\"),\n    sort_order: zod__WEBPACK_IMPORTED_MODULE_3__[\"enum\"]([\n        \"asc\",\n        \"desc\"\n    ]).default(\"desc\")\n});\n// Helper function to generate cache key\nfunction generateCacheKey(query) {\n    const { category, author_id, start_date, end_date, search, sort_by: sort_by1, sort_order, page, limit } = query;\n    const keyParts = [\n        category || \"all\",\n        author_id || \"all\",\n        start_date || \"all\",\n        end_date || \"all\",\n        search || \"all\",\n        sort_by1,\n        sort_order,\n        page,\n        limit\n    ];\n    return `news:${keyParts.join(\":\")}`;\n}\n// Helper function to build SQL query safely\nfunction buildNewsQuery(query) {\n    const { category, author_id, start_date, end_date, search, sort_by: sort_by1, sort_order, page, limit } = query;\n    const offset = (page - 1) * limit;\n    // Build WHERE conditions array\n    const conditions = [\n        \"n.is_published = true\"\n    ];\n    // Add category filter if provided\n    if (category) {\n        conditions.push(`n.category = ${escapeValue(category)}`);\n    }\n    // Add author filter if provided\n    if (author_id) {\n        conditions.push(`n.author_id = ${escapeValue(author_id)}`);\n    }\n    // Add date range filters if provided\n    if (start_date) {\n        conditions.push(`n.published_at >= ${escapeValue(start_date)}`);\n    }\n    if (end_date) {\n        conditions.push(`n.published_at <= ${escapeValue(end_date)}`);\n    }\n    // Add search filter if provided (use existing search_vector)\n    if (search) {\n        conditions.push(`n.search_vector @@ to_tsquery('spanish', ${escapeValue(search)})`);\n    }\n    // Combine WHERE conditions\n    const whereClause = conditions.length > 0 ? `WHERE ${conditions.join(\" AND \")}` : \"\";\n    // Build ORDER BY clause\n    const orderByClause = `ORDER BY n.${sort_by1} ${sort_order.toUpperCase()}`;\n    // Build pagination\n    const paginationClause = `LIMIT $${conditions.length + 1} OFFSET $${conditions.length + 2}`;\n    // Final query with parameterized values\n    const sql = `\n    SELECT\n      n.id,\n      n.title,\n      n.content,\n      n.category,\n      n.author_id,\n      n.created_at,\n      n.published_at,\n      n.is_published,\n      COALESCE(p.full_name, 'Unknown') as author_name,\n      COALESCE(u.email, p.email) as author_email,\n      COUNT(DISTINCT c.id) as comment_count\n    FROM news n\n    LEFT JOIN public.profiles p ON n.author_id = p.id\n    LEFT JOIN auth.users u ON p.id = u.id\n    LEFT JOIN comments c ON n.id = c.news_id AND c.parent_comment_id IS NULL\n    ${whereClause}\n    ${orderByClause}\n    ${paginationClause}\n  `;\n    // Build parameters array (pagination parameters go last)\n    const params = [\n        ...conditions.filter((_, index)=>{\n            // Only add parameters for non-constant conditions\n            return !conditions[index].includes(\"is_published = true\");\n        }).map((condition)=>{\n            if (condition.includes(\"=\")) {\n                const value = condition.split(\"=\")[1].trim();\n                return unescapeValue(value);\n            }\n            return null;\n        }).filter(Boolean),\n        limit,\n        offset\n    ];\n    return {\n        sql,\n        params\n    };\n}\n// Helper function to safely escape values\nfunction escapeValue(value) {\n    return `$${value.replace(/'/g, \"''\")}`;\n}\n// Helper function to unescape values for parameterized queries\nfunction unescapeValue(value) {\n    if (value.startsWith(\"'\") && value.endsWith(\"'\")) {\n        return value.slice(1, -1);\n    }\n    return value;\n}\n// Main GET handler\nasync function GET(request) {\n    const startTime = performance.now();\n    const requestId = crypto.randomUUID();\n    try {\n        // Extract IP from request\n        const ip = request.ip || \"unknown\";\n        const userAgent = request.headers.get(\"user-agent\") || \"unknown\";\n        // Apply rate limiting (100 requests per minute per IP)\n        const rateLimitResult = await _lib_rateLimiter__WEBPACK_IMPORTED_MODULE_2__.rateLimiter.checkLimit(request, \"/api/news\");\n        if (!rateLimitResult.allowed) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Rate limit exceeded\",\n                message: \"Too many requests. Please try again later.\",\n                retry_after: rateLimitResult.limitInfo?.retryAfter || 60,\n                request_id: requestId\n            }, {\n                status: 429,\n                headers: {\n                    \"X-RateLimit-Limit\": \"100\",\n                    \"X-RateLimit-Remaining\": \"0\",\n                    \"X-RateLimit-Reset\": new Date(Date.now() + (rateLimitResult.limitInfo?.retryAfter || 60) * 1000).toUTCString(),\n                    \"Retry-After\": rateLimitResult.limitInfo?.retryAfter?.toString() || \"60\",\n                    \"Cache-Control\": \"no-store\"\n                }\n            });\n        }\n        // Parse and validate query parameters\n        const searchParams = request.nextUrl.searchParams;\n        const rawQuery = Object.fromEntries(searchParams.entries());\n        const query = newsQuerySchema.parse(rawQuery);\n        // Generate cache key\n        const cacheKey = generateCacheKey(query);\n        // Try to get cached data first\n        try {\n            const cachedData = await fetch(`${\"https://bmwuxzysmznqukvnziqc.supabase.co\"}/rest/v1/cache?news_key=eq.${cacheKey}`, {\n                headers: {\n                    apikey: \"sb_publishable_KGnm3YmA2wr_e__advPzow_OdOJPu9w\",\n                    Authorization: `Bearer ${\"sb_publishable_KGnm3YmA2wr_e__advPzow_OdOJPu9w\"}`\n                }\n            });\n            if (cachedData.ok) {\n                const cachedResponse = await cachedData.json();\n                if (cachedResponse.length > 0) {\n                    // Return cached response with cache headers\n                    return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                        ...cachedResponse[0],\n                        from_cache: true,\n                        request_id: requestId,\n                        performance: {\n                            execution_time_ms: performance.now() - startTime,\n                            method: \"cached\"\n                        }\n                    }, {\n                        headers: {\n                            \"Cache-Control\": \"public, s-maxage=300, stale-while-revalidate=600\",\n                            \"ETag\": `\"${cacheKey}\"`,\n                            \"X-Cache\": \"HIT\"\n                        }\n                    });\n                }\n            }\n        } catch (cacheError) {\n            console.warn(\"Cache fetch failed, proceeding with fresh query:\", cacheError);\n        }\n        // Build optimized SQL query\n        const { sql, params } = buildNewsQuery(query);\n        console.log(`[${requestId}] Executing query:`, sql);\n        console.log(`[${requestId}] Parameters:`, params);\n        // Execute the query using Supabase RPC for parameterized queries\n        const { data: results, error } = await _lib_supabase__WEBPACK_IMPORTED_MODULE_1__.supabaseService.rpc(\"exec_sql\", {\n            query: sql,\n            params: JSON.stringify(params)\n        });\n        if (error) {\n            console.error(`[${requestId}] Database error:`, error);\n            // Fallback to simple Supabase query if RPC fails\n            try {\n                let simpleQuery = _lib_supabase__WEBPACK_IMPORTED_MODULE_1__.supabaseService.from(\"news\").select(`\n            id,\n            title,\n            content,\n            category,\n            author_id,\n            created_at,\n            published_at,\n            is_published,\n            profiles!inner(\n              full_name,\n              email\n            ),\n            comment_count\n          `, {\n                    count: \"exact\"\n                }).eq(\"is_published\", true).order(sort_by, {\n                    ascending: query.sort_order === \"asc\"\n                }).range((query.page - 1) * query.limit, query.page * query.limit - 1);\n                // Apply filters\n                if (query.category) {\n                    simpleQuery = simpleQuery.eq(\"category\", query.category);\n                }\n                if (query.author_id) {\n                    simpleQuery = simpleQuery.eq(\"author_id\", query.author_id);\n                }\n                if (query.start_date) {\n                    simpleQuery = simpleQuery.gte(\"published_at\", query.start_date);\n                }\n                if (query.end_date) {\n                    simpleQuery = simpleQuery.lte(\"published_at\", query.end_date);\n                }\n                const { data: simpleResults, error: simpleError, count } = await simpleQuery;\n                if (simpleError) {\n                    throw new Error(`Simple fallback error: ${simpleError.message}`);\n                }\n                // Transform results to include comment count (requires separate query)\n                const newsWithComments = await Promise.all((simpleResults || []).map(async (news)=>{\n                    const { data: comments } = await _lib_supabase__WEBPACK_IMPORTED_MODULE_1__.supabaseService.from(\"comments\").select(\"id\", {\n                        count: \"exact\"\n                    }).eq(\"news_id\", news.id).eq(\"parent_comment_id\", null);\n                    return {\n                        ...news,\n                        comment_count: comments?.length || 0,\n                        author_name: news.profiles?.full_name || \"Unknown\",\n                        author_email: news.profiles?.email || null\n                    };\n                }));\n                const response = {\n                    success: true,\n                    data: newsWithComments,\n                    pagination: {\n                        page: query.page,\n                        limit: query.limit,\n                        total_results: count || 0,\n                        total_pages: Math.ceil((count || 0) / query.limit)\n                    },\n                    filters: {\n                        category: query.category || undefined,\n                        author_id: query.author_id || undefined,\n                        start_date: query.start_date || undefined,\n                        end_date: query.end_date || undefined,\n                        search: query.search || undefined,\n                        sort_by: query.sort_by,\n                        sort_order: query.sort_order\n                    },\n                    performance: {\n                        execution_time_ms: performance.now() - startTime,\n                        method: \"fallback_simple\",\n                        request_id: requestId\n                    }\n                };\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json(response, {\n                    headers: {\n                        \"Cache-Control\": \"public, s-maxage=60, stale-while-revalidate=300\",\n                        \"X-Cache\": \"MISS\",\n                        \"X-Request-ID\": requestId\n                    }\n                });\n            } catch (fallbackError) {\n                console.error(`[${requestId}] Fallback error:`, fallbackError);\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    error: \"Failed to fetch news\",\n                    details: fallbackError instanceof Error ? fallbackError.message : \"Unknown error\",\n                    request_id: requestId\n                }, {\n                    status: 500\n                });\n            }\n        }\n        // Transform results to expected format\n        const transformedResults = (results || []).map((item)=>({\n                id: item.id,\n                title: item.title,\n                content: item.content,\n                category: item.category,\n                author_id: item.author_id,\n                author_name: item.author_name || \"Unknown\",\n                author_email: item.author_email || null,\n                created_at: item.created_at,\n                published_at: item.published_at,\n                is_published: item.is_published,\n                comment_count: parseInt(item.comment_count) || 0\n            }));\n        // Get total count for pagination\n        let totalCount = 0;\n        if (results && results.length > 0) {\n            totalCount = parseInt(results[0].total_count) || transformedResults.length;\n        } else {\n            totalCount = transformedResults.length;\n        }\n        // Build successful response\n        const response = {\n            success: true,\n            data: transformedResults,\n            pagination: {\n                page: query.page,\n                limit: query.limit,\n                total_results: totalCount,\n                total_pages: Math.ceil(totalCount / query.limit)\n            },\n            filters: {\n                category: query.category || undefined,\n                author_id: query.author_id || undefined,\n                start_date: query.start_date || undefined,\n                end_date: query.end_date || undefined,\n                search: query.search || undefined,\n                sort_by: query.sort_by,\n                sort_order: query.sort_order\n            },\n            performance: {\n                execution_time_ms: performance.now() - startTime,\n                method: \"optimized_query\",\n                request_id: requestId,\n                cache_status: \"miss\"\n            }\n        };\n        // Cache the response using Next.js revalidate\n        try {\n            // Using Next.js caching mechanisms\n            response.from_cache = false;\n        } catch (cacheError) {\n            console.warn(`[${requestId}] Caching failed:`, cacheError);\n        }\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json(response, {\n            headers: {\n                \"Cache-Control\": \"public, s-maxage=300, stale-while-revalidate=600\",\n                \"ETag\": `\"${cacheKey}\"`,\n                \"Last-Modified\": new Date().toUTCString(),\n                \"X-Cache\": \"MISS\",\n                \"X-Request-ID\": requestId\n            }\n        });\n    } catch (error) {\n        console.error(`[${requestId}] News API error:`, error);\n        // Handle different types of errors\n        if (error instanceof zod__WEBPACK_IMPORTED_MODULE_3__.ZodError) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Validation error\",\n                details: \"Invalid query parameters\",\n                errors: error.errors,\n                request_id: requestId\n            }, {\n                status: 400\n            });\n        }\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: \"Internal server error\",\n            details: error instanceof Error ? error.message : \"Unknown error\",\n            request_id: requestId\n        }, {\n            status: 500\n        });\n    }\n}\n// POST handler for creating news (administrative)\nasync function POST(request) {\n    const requestId = crypto.randomUUID();\n    try {\n        const body = await request.json();\n        const { title, content, category, author_id, published_at } = body;\n        // Basic validation\n        if (!title || title.trim().length < 3) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Validation error\",\n                message: \"Title is required and must be at least 3 characters long\",\n                request_id: requestId\n            }, {\n                status: 400\n            });\n        }\n        if (!content || content.trim().length < 10) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Validation error\",\n                message: \"Content is required and must be at least 10 characters long\",\n                request_id: requestId\n            }, {\n                status: 400\n            });\n        }\n        // Validate category if provided\n        const validCategories = [\n            \"national\",\n            \"international\",\n            \"technology\",\n            \"sports\",\n            \"culture\"\n        ];\n        if (category && !validCategories.includes(category)) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Validation error\",\n                message: `Invalid category. Must be one of: ${validCategories.join(\", \")}`,\n                request_id: requestId\n            }, {\n                status: 400\n            });\n        }\n        // Create news entry\n        const { data: newNews, error } = await _lib_supabase__WEBPACK_IMPORTED_MODULE_1__.supabaseService.from(\"news\").insert([\n            {\n                title: title.trim(),\n                content: content.trim(),\n                category,\n                author_id: author_id || null,\n                published_at: published_at || null,\n                is_published: false // Default unpublished for approval\n            }\n        ]).select().single();\n        if (error) {\n            console.error(`[${requestId}] Create news error:`, error);\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Failed to create news\",\n                details: error.message,\n                request_id: requestId\n            }, {\n                status: 500\n            });\n        }\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            success: true,\n            data: newNews,\n            message: \"News created successfully. Awaiting approval.\",\n            performance: {\n                execution_time_ms: performance.now(),\n                request_id: requestId\n            }\n        });\n    } catch (error) {\n        console.error(`[${requestId}] Create news API error:`, error);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: \"Internal server error\",\n            details: error instanceof Error ? error.message : \"Unknown error\",\n            request_id: requestId\n        }, {\n            status: 500\n        });\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QixNQUFNeUQ7WUFDTjNGLFNBQVM7WUFDVGQsYUFBYTtnQkFDWDBDLG1CQUFtQjFDLFlBQVlDLEdBQUc7Z0JBQ2xDaUIsWUFBWWhCO1lBQ2Q7UUFDRjtJQUVGLEVBQUUsT0FBT1csT0FBTztRQUNkZ0MsUUFBUWhDLEtBQUssQ0FBQyxDQUFDLENBQUMsRUFBRVgsVUFBVSx3QkFBd0IsQ0FBQyxFQUFFVztRQUN2RCxPQUFPeEUscURBQVlBLENBQUN1RSxJQUFJLENBQ3RCO1lBQ0VDLE9BQU87WUFDUDJFLFNBQVMzRSxpQkFBaUJvRCxRQUFRcEQsTUFBTUMsT0FBTyxHQUFHO1lBQ2xESSxZQUFZaEI7UUFDZCxHQUNBO1lBQUVpQixRQUFRO1FBQUk7SUFFbEI7QUFDRiIsInNvdXJjZXMiOlsid2VicGFjazovL25vdGktZXNldC8uL3NyYy9hcHAvYXBpL25ld3Mvcm91dGUudHM/NWRmNCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBOZXh0UmVxdWVzdCwgTmV4dFJlc3BvbnNlIH0gZnJvbSAnbmV4dC9zZXJ2ZXInO1xuaW1wb3J0IHsgeiB9IGZyb20gJ3pvZCc7XG5pbXBvcnQgeyBzdXBhYmFzZVNlcnZpY2UgfSBmcm9tICdAL2xpYi9zdXBhYmFzZSc7XG5pbXBvcnQgeyByYXRlTGltaXRlciB9IGZyb20gJ0AvbGliL3JhdGVMaW1pdGVyJztcblxuLy8gWm9kIHNjaGVtYSBmb3IgcXVlcnkgcGFyYW1ldGVyIHZhbGlkYXRpb25cbmNvbnN0IG5ld3NRdWVyeVNjaGVtYSA9IHoub2JqZWN0KHtcbiAgcGFnZTogei5jb2VyY2UubnVtYmVyKCkubWluKDEpLm1heCgxMDAwKS5kZWZhdWx0KDEpLFxuICBsaW1pdDogei5jb2VyY2UubnVtYmVyKCkubWluKDEpLm1heCgxMDApLmRlZmF1bHQoMjApLFxuICBjYXRlZ29yeTogei5lbnVtKFsnbmF0aW9uYWwnLCAnaW50ZXJuYXRpb25hbCcsICd0ZWNobm9sb2d5JywgJ3Nwb3J0cycsICdjdWx0dXJlJ10pLm9wdGlvbmFsKCksXG4gIGF1dGhvcl9pZDogei5zdHJpbmcoKS51dWlkKCkub3B0aW9uYWwoKSxcbiAgc3RhcnRfZGF0ZTogei5zdHJpbmcoKS5kYXRldGltZSgpLm9wdGlvbmFsKCksXG4gIGVuZF9kYXRlOiB6LnN0cmluZygpLmRhdGV0aW1lKCkub3B0aW9uYWwoKSxcbiAgc2VhcmNoOiB6LnN0cmluZygpLm1pbigxKS5tYXgoMTAwKS5vcHRpb25hbCgpLFxuICBzb3J0X2J5OiB6LmVudW0oWydwdWJsaXNoZWRfYXQnLCAnY3JlYXRlZF9hdCcsICd0aXRsZScsICdjYXRlZ29yeSddKS5kZWZhdWx0KCdwdWJsaXNoZWRfYXQnKSxcbiAgc29ydF9vcmRlcjogei5lbnVtKFsnYXNjJywgJ2Rlc2MnXSkuZGVmYXVsdCgnZGVzYycpXG59KTtcblxudHlwZSBOZXdzUXVlcnkgPSB6LmluZmVyPHR5cGVvZiBuZXdzUXVlcnlTY2hlbWE+O1xuXG4vLyBIZWxwZXIgZnVuY3Rpb24gdG8gZ2VuZXJhdGUgY2FjaGUga2V5XG5mdW5jdGlvbiBnZW5lcmF0ZUNhY2hlS2V5KHF1ZXJ5OiBOZXdzUXVlcnkpOiBzdHJpbmcge1xuICBjb25zdCB7IGNhdGVnb3J5LCBhdXRob3JfaWQsIHN0YXJ0X2RhdGUsIGVuZF9kYXRlLCBzZWFyY2gsIHNvcnRfYnksIHNvcnRfb3JkZXIsIHBhZ2UsIGxpbWl0IH0gPSBxdWVyeTtcbiAgY29uc3Qga2V5UGFydHMgPSBbXG4gICAgY2F0ZWdvcnkgfHwgJ2FsbCcsXG4gICAgYXV0aG9yX2lkIHx8ICdhbGwnLFxuICAgIHN0YXJ0X2RhdGUgfHwgJ2FsbCcsXG4gICAgZW5kX2RhdGUgfHwgJ2FsbCcsXG4gICAgc2VhcmNoIHx8ICdhbGwnLFxuICAgIHNvcnRfYnksXG4gICAgc29ydF9vcmRlcixcbiAgICBwYWdlLFxuICAgIGxpbWl0XG4gIF07XG4gIHJldHVybiBgbmV3czoke2tleVBhcnRzLmpvaW4oJzonKX1gO1xufVxuXG4vLyBIZWxwZXIgZnVuY3Rpb24gdG8gYnVpbGQgU1FMIHF1ZXJ5IHNhZmVseVxuZnVuY3Rpb24gYnVpbGROZXdzUXVlcnkocXVlcnk6IE5ld3NRdWVyeSk6IHtcbiAgc3FsOiBzdHJpbmc7XG4gIHBhcmFtczogYW55W107XG59IHtcbiAgY29uc3Qge1xuICAgIGNhdGVnb3J5LFxuICAgIGF1dGhvcl9pZCxcbiAgICBzdGFydF9kYXRlLFxuICAgIGVuZF9kYXRlLFxuICAgIHNlYXJjaCxcbiAgICBzb3J0X2J5LFxuICAgIHNvcnRfb3JkZXIsXG4gICAgcGFnZSxcbiAgICBsaW1pdFxuICB9ID0gcXVlcnk7XG5cbiAgY29uc3Qgb2Zmc2V0ID0gKHBhZ2UgLSAxKSAqIGxpbWl0O1xuXG4gIC8vIEJ1aWxkIFdIRVJFIGNvbmRpdGlvbnMgYXJyYXlcbiAgY29uc3QgY29uZGl0aW9uczogc3RyaW5nW10gPSBbJ24uaXNfcHVibGlzaGVkID0gdHJ1ZSddO1xuXG4gIC8vIEFkZCBjYXRlZ29yeSBmaWx0ZXIgaWYgcHJvdmlkZWRcbiAgaWYgKGNhdGVnb3J5KSB7XG4gICAgY29uZGl0aW9ucy5wdXNoKGBuLmNhdGVnb3J5ID0gJHtlc2NhcGVWYWx1ZShjYXRlZ29yeSl9YCk7XG4gIH1cblxuICAvLyBBZGQgYXV0aG9yIGZpbHRlciBpZiBwcm92aWRlZFxuICBpZiAoYXV0aG9yX2lkKSB7XG4gICAgY29uZGl0aW9ucy5wdXNoKGBuLmF1dGhvcl9pZCA9ICR7ZXNjYXBlVmFsdWUoYXV0aG9yX2lkKX1gKTtcbiAgfVxuXG4gIC8vIEFkZCBkYXRlIHJhbmdlIGZpbHRlcnMgaWYgcHJvdmlkZWRcbiAgaWYgKHN0YXJ0X2RhdGUpIHtcbiAgICBjb25kaXRpb25zLnB1c2goYG4ucHVibGlzaGVkX2F0ID49ICR7ZXNjYXBlVmFsdWUoc3RhcnRfZGF0ZSl9YCk7XG4gIH1cblxuICBpZiAoZW5kX2RhdGUpIHtcbiAgICBjb25kaXRpb25zLnB1c2goYG4ucHVibGlzaGVkX2F0IDw9ICR7ZXNjYXBlVmFsdWUoZW5kX2RhdGUpfWApO1xuICB9XG5cbiAgLy8gQWRkIHNlYXJjaCBmaWx0ZXIgaWYgcHJvdmlkZWQgKHVzZSBleGlzdGluZyBzZWFyY2hfdmVjdG9yKVxuICBpZiAoc2VhcmNoKSB7XG4gICAgY29uZGl0aW9ucy5wdXNoKFxuICAgICAgYG4uc2VhcmNoX3ZlY3RvciBAQCB0b190c3F1ZXJ5KCdzcGFuaXNoJywgJHtlc2NhcGVWYWx1ZShzZWFyY2gpfSlgXG4gICAgKTtcbiAgfVxuXG4gIC8vIENvbWJpbmUgV0hFUkUgY29uZGl0aW9uc1xuICBjb25zdCB3aGVyZUNsYXVzZSA9IGNvbmRpdGlvbnMubGVuZ3RoID4gMCA/IGBXSEVSRSAke2NvbmRpdGlvbnMuam9pbignIEFORCAnKX1gIDogJyc7XG5cbiAgLy8gQnVpbGQgT1JERVIgQlkgY2xhdXNlXG4gIGNvbnN0IG9yZGVyQnlDbGF1c2UgPSBgT1JERVIgQlkgbi4ke3NvcnRfYnl9ICR7c29ydF9vcmRlci50b1VwcGVyQ2FzZSgpfWA7XG5cbiAgLy8gQnVpbGQgcGFnaW5hdGlvblxuICBjb25zdCBwYWdpbmF0aW9uQ2xhdXNlID0gYExJTUlUICQke2NvbmRpdGlvbnMubGVuZ3RoICsgMX0gT0ZGU0VUICQke2NvbmRpdGlvbnMubGVuZ3RoICsgMn1gO1xuXG4gIC8vIEZpbmFsIHF1ZXJ5IHdpdGggcGFyYW1ldGVyaXplZCB2YWx1ZXNcbiAgY29uc3Qgc3FsID0gYFxuICAgIFNFTEVDVFxuICAgICAgbi5pZCxcbiAgICAgIG4udGl0bGUsXG4gICAgICBuLmNvbnRlbnQsXG4gICAgICBuLmNhdGVnb3J5LFxuICAgICAgbi5hdXRob3JfaWQsXG4gICAgICBuLmNyZWF0ZWRfYXQsXG4gICAgICBuLnB1Ymxpc2hlZF9hdCxcbiAgICAgIG4uaXNfcHVibGlzaGVkLFxuICAgICAgQ09BTEVTQ0UocC5mdWxsX25hbWUsICdVbmtub3duJykgYXMgYXV0aG9yX25hbWUsXG4gICAgICBDT0FMRVNDRSh1LmVtYWlsLCBwLmVtYWlsKSBhcyBhdXRob3JfZW1haWwsXG4gICAgICBDT1VOVChESVNUSU5DVCBjLmlkKSBhcyBjb21tZW50X2NvdW50XG4gICAgRlJPTSBuZXdzIG5cbiAgICBMRUZUIEpPSU4gcHVibGljLnByb2ZpbGVzIHAgT04gbi5hdXRob3JfaWQgPSBwLmlkXG4gICAgTEVGVCBKT0lOIGF1dGgudXNlcnMgdSBPTiBwLmlkID0gdS5pZFxuICAgIExFRlQgSk9JTiBjb21tZW50cyBjIE9OIG4uaWQgPSBjLm5ld3NfaWQgQU5EIGMucGFyZW50X2NvbW1lbnRfaWQgSVMgTlVMTFxuICAgICR7d2hlcmVDbGF1c2V9XG4gICAgJHtvcmRlckJ5Q2xhdXNlfVxuICAgICR7cGFnaW5hdGlvbkNsYXVzZX1cbiAgYDtcblxuICAvLyBCdWlsZCBwYXJhbWV0ZXJzIGFycmF5IChwYWdpbmF0aW9uIHBhcmFtZXRlcnMgZ28gbGFzdClcbiAgY29uc3QgcGFyYW1zID0gW1xuICAgIC4uLmNvbmRpdGlvbnNcbiAgICAgIC5maWx0ZXIoKF8sIGluZGV4KSA9PiB7XG4gICAgICAgIC8vIE9ubHkgYWRkIHBhcmFtZXRlcnMgZm9yIG5vbi1jb25zdGFudCBjb25kaXRpb25zXG4gICAgICAgIHJldHVybiAhY29uZGl0aW9uc1tpbmRleF0uaW5jbHVkZXMoJ2lzX3B1Ymxpc2hlZCA9IHRydWUnKTtcbiAgICAgIH0pXG4gICAgICAubWFwKGNvbmRpdGlvbiA9PiB7XG4gICAgICAgIGlmIChjb25kaXRpb24uaW5jbHVkZXMoJz0nKSkge1xuICAgICAgICAgIGNvbnN0IHZhbHVlID0gY29uZGl0aW9uLnNwbGl0KCc9JylbMV0udHJpbSgpO1xuICAgICAgICAgIHJldHVybiB1bmVzY2FwZVZhbHVlKHZhbHVlKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH0pXG4gICAgICAuZmlsdGVyKEJvb2xlYW4pLFxuICAgIGxpbWl0LFxuICAgIG9mZnNldFxuICBdO1xuXG4gIHJldHVybiB7IHNxbCwgcGFyYW1zIH07XG59XG5cbi8vIEhlbHBlciBmdW5jdGlvbiB0byBzYWZlbHkgZXNjYXBlIHZhbHVlc1xuZnVuY3Rpb24gZXNjYXBlVmFsdWUodmFsdWU6IHN0cmluZyk6IHN0cmluZyB7XG4gIHJldHVybiBgJCR7dmFsdWUucmVwbGFjZSgvJy9nLCBcIicnXCIpfWA7XG59XG5cbi8vIEhlbHBlciBmdW5jdGlvbiB0byB1bmVzY2FwZSB2YWx1ZXMgZm9yIHBhcmFtZXRlcml6ZWQgcXVlcmllc1xuZnVuY3Rpb24gdW5lc2NhcGVWYWx1ZSh2YWx1ZTogc3RyaW5nKTogc3RyaW5nIHtcbiAgaWYgKHZhbHVlLnN0YXJ0c1dpdGgoXCInXCIpICYmIHZhbHVlLmVuZHNXaXRoKFwiJ1wiKSkge1xuICAgIHJldHVybiB2YWx1ZS5zbGljZSgxLCAtMSk7XG4gIH1cbiAgcmV0dXJuIHZhbHVlO1xufVxuXG4vLyBNYWluIEdFVCBoYW5kbGVyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gR0VUKHJlcXVlc3Q6IE5leHRSZXF1ZXN0KSB7XG4gIGNvbnN0IHN0YXJ0VGltZSA9IHBlcmZvcm1hbmNlLm5vdygpO1xuICBjb25zdCByZXF1ZXN0SWQgPSBjcnlwdG8ucmFuZG9tVVVJRCgpO1xuXG4gIHRyeSB7XG4gICAgLy8gRXh0cmFjdCBJUCBmcm9tIHJlcXVlc3RcbiAgICBjb25zdCBpcCA9IHJlcXVlc3QuaXAgfHwgJ3Vua25vd24nO1xuICAgIGNvbnN0IHVzZXJBZ2VudCA9IHJlcXVlc3QuaGVhZGVycy5nZXQoJ3VzZXItYWdlbnQnKSB8fCAndW5rbm93bic7XG5cbiAgICAvLyBBcHBseSByYXRlIGxpbWl0aW5nICgxMDAgcmVxdWVzdHMgcGVyIG1pbnV0ZSBwZXIgSVApXG4gICAgY29uc3QgcmF0ZUxpbWl0UmVzdWx0ID0gYXdhaXQgcmF0ZUxpbWl0ZXIuY2hlY2tMaW1pdChyZXF1ZXN0LCAnL2FwaS9uZXdzJyk7XG4gICAgaWYgKCFyYXRlTGltaXRSZXN1bHQuYWxsb3dlZCkge1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICB7XG4gICAgICAgICAgZXJyb3I6ICdSYXRlIGxpbWl0IGV4Y2VlZGVkJyxcbiAgICAgICAgICBtZXNzYWdlOiAnVG9vIG1hbnkgcmVxdWVzdHMuIFBsZWFzZSB0cnkgYWdhaW4gbGF0ZXIuJyxcbiAgICAgICAgICByZXRyeV9hZnRlcjogcmF0ZUxpbWl0UmVzdWx0LmxpbWl0SW5mbz8ucmV0cnlBZnRlciB8fCA2MCxcbiAgICAgICAgICByZXF1ZXN0X2lkOiByZXF1ZXN0SWRcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIHN0YXR1czogNDI5LFxuICAgICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICAgICdYLVJhdGVMaW1pdC1MaW1pdCc6ICcxMDAnLFxuICAgICAgICAgICAgJ1gtUmF0ZUxpbWl0LVJlbWFpbmluZyc6ICcwJyxcbiAgICAgICAgICAgICdYLVJhdGVMaW1pdC1SZXNldCc6IG5ldyBEYXRlKERhdGUubm93KCkgKyAocmF0ZUxpbWl0UmVzdWx0LmxpbWl0SW5mbz8ucmV0cnlBZnRlciB8fCA2MCkgKiAxMDAwKS50b1VUQ1N0cmluZygpLFxuICAgICAgICAgICAgJ1JldHJ5LUFmdGVyJzogcmF0ZUxpbWl0UmVzdWx0LmxpbWl0SW5mbz8ucmV0cnlBZnRlcj8udG9TdHJpbmcoKSB8fCAnNjAnLFxuICAgICAgICAgICAgJ0NhY2hlLUNvbnRyb2wnOiAnbm8tc3RvcmUnXG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICApO1xuICAgIH1cblxuICAgIC8vIFBhcnNlIGFuZCB2YWxpZGF0ZSBxdWVyeSBwYXJhbWV0ZXJzXG4gICAgY29uc3Qgc2VhcmNoUGFyYW1zID0gcmVxdWVzdC5uZXh0VXJsLnNlYXJjaFBhcmFtcztcbiAgICBjb25zdCByYXdRdWVyeSA9IE9iamVjdC5mcm9tRW50cmllcyhzZWFyY2hQYXJhbXMuZW50cmllcygpKTtcblxuICAgIGNvbnN0IHF1ZXJ5ID0gbmV3c1F1ZXJ5U2NoZW1hLnBhcnNlKHJhd1F1ZXJ5KTtcblxuICAgIC8vIEdlbmVyYXRlIGNhY2hlIGtleVxuICAgIGNvbnN0IGNhY2hlS2V5ID0gZ2VuZXJhdGVDYWNoZUtleShxdWVyeSk7XG5cbiAgICAvLyBUcnkgdG8gZ2V0IGNhY2hlZCBkYXRhIGZpcnN0XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGNhY2hlZERhdGEgPSBhd2FpdCBmZXRjaChcbiAgICAgICAgYCR7cHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfU1VQQUJBU0VfVVJMfS9yZXN0L3YxL2NhY2hlP25ld3Nfa2V5PWVxLiR7Y2FjaGVLZXl9YCxcbiAgICAgICAge1xuICAgICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICAgIGFwaWtleTogcHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfU1VQQUJBU0VfQU5PTl9LRVkhLFxuICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3Byb2Nlc3MuZW52Lk5FWFRfUFVCTElDX1NVUEFCQVNFX0FOT05fS0VZIX1gXG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICApO1xuXG4gICAgICBpZiAoY2FjaGVkRGF0YS5vaykge1xuICAgICAgICBjb25zdCBjYWNoZWRSZXNwb25zZSA9IGF3YWl0IGNhY2hlZERhdGEuanNvbigpO1xuICAgICAgICBpZiAoY2FjaGVkUmVzcG9uc2UubGVuZ3RoID4gMCkge1xuICAgICAgICAgIC8vIFJldHVybiBjYWNoZWQgcmVzcG9uc2Ugd2l0aCBjYWNoZSBoZWFkZXJzXG4gICAgICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHtcbiAgICAgICAgICAgIC4uLmNhY2hlZFJlc3BvbnNlWzBdLFxuICAgICAgICAgICAgZnJvbV9jYWNoZTogdHJ1ZSxcbiAgICAgICAgICAgIHJlcXVlc3RfaWQ6IHJlcXVlc3RJZCxcbiAgICAgICAgICAgIHBlcmZvcm1hbmNlOiB7XG4gICAgICAgICAgICAgIGV4ZWN1dGlvbl90aW1lX21zOiBwZXJmb3JtYW5jZS5ub3coKSAtIHN0YXJ0VGltZSxcbiAgICAgICAgICAgICAgbWV0aG9kOiAnY2FjaGVkJ1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0sIHtcbiAgICAgICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICAgICAgJ0NhY2hlLUNvbnRyb2wnOiAncHVibGljLCBzLW1heGFnZT0zMDAsIHN0YWxlLXdoaWxlLXJldmFsaWRhdGU9NjAwJyxcbiAgICAgICAgICAgICAgJ0VUYWcnOiBgXCIke2NhY2hlS2V5fVwiYCxcbiAgICAgICAgICAgICAgJ1gtQ2FjaGUnOiAnSElUJ1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSBjYXRjaCAoY2FjaGVFcnJvcikge1xuICAgICAgY29uc29sZS53YXJuKCdDYWNoZSBmZXRjaCBmYWlsZWQsIHByb2NlZWRpbmcgd2l0aCBmcmVzaCBxdWVyeTonLCBjYWNoZUVycm9yKTtcbiAgICB9XG5cbiAgICAvLyBCdWlsZCBvcHRpbWl6ZWQgU1FMIHF1ZXJ5XG4gICAgY29uc3QgeyBzcWwsIHBhcmFtcyB9ID0gYnVpbGROZXdzUXVlcnkocXVlcnkpO1xuXG4gICAgY29uc29sZS5sb2coYFske3JlcXVlc3RJZH1dIEV4ZWN1dGluZyBxdWVyeTpgLCBzcWwpO1xuICAgIGNvbnNvbGUubG9nKGBbJHtyZXF1ZXN0SWR9XSBQYXJhbWV0ZXJzOmAsIHBhcmFtcyk7XG5cbiAgICAvLyBFeGVjdXRlIHRoZSBxdWVyeSB1c2luZyBTdXBhYmFzZSBSUEMgZm9yIHBhcmFtZXRlcml6ZWQgcXVlcmllc1xuICAgIGNvbnN0IHsgZGF0YTogcmVzdWx0cywgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlU2VydmljZVxuICAgICAgLnJwYygnZXhlY19zcWwnLCB7XG4gICAgICAgIHF1ZXJ5OiBzcWwsXG4gICAgICAgIHBhcmFtczogSlNPTi5zdHJpbmdpZnkocGFyYW1zKVxuICAgICAgfSk7XG5cbiAgICBpZiAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoYFske3JlcXVlc3RJZH1dIERhdGFiYXNlIGVycm9yOmAsIGVycm9yKTtcblxuICAgICAgLy8gRmFsbGJhY2sgdG8gc2ltcGxlIFN1cGFiYXNlIHF1ZXJ5IGlmIFJQQyBmYWlsc1xuICAgICAgdHJ5IHtcbiAgICAgICAgbGV0IHNpbXBsZVF1ZXJ5ID0gc3VwYWJhc2VTZXJ2aWNlXG4gICAgICAgICAgLmZyb20oJ25ld3MnKVxuICAgICAgICAgIC5zZWxlY3QoYFxuICAgICAgICAgICAgaWQsXG4gICAgICAgICAgICB0aXRsZSxcbiAgICAgICAgICAgIGNvbnRlbnQsXG4gICAgICAgICAgICBjYXRlZ29yeSxcbiAgICAgICAgICAgIGF1dGhvcl9pZCxcbiAgICAgICAgICAgIGNyZWF0ZWRfYXQsXG4gICAgICAgICAgICBwdWJsaXNoZWRfYXQsXG4gICAgICAgICAgICBpc19wdWJsaXNoZWQsXG4gICAgICAgICAgICBwcm9maWxlcyFpbm5lcihcbiAgICAgICAgICAgICAgZnVsbF9uYW1lLFxuICAgICAgICAgICAgICBlbWFpbFxuICAgICAgICAgICAgKSxcbiAgICAgICAgICAgIGNvbW1lbnRfY291bnRcbiAgICAgICAgICBgLCB7IGNvdW50OiAnZXhhY3QnIH0pXG4gICAgICAgICAgLmVxKCdpc19wdWJsaXNoZWQnLCB0cnVlKVxuICAgICAgICAgIC5vcmRlcihzb3J0X2J5IGFzIGFueSwgeyBhc2NlbmRpbmc6IHF1ZXJ5LnNvcnRfb3JkZXIgPT09ICdhc2MnIH0pXG4gICAgICAgICAgLnJhbmdlKChxdWVyeS5wYWdlIC0gMSkgKiBxdWVyeS5saW1pdCwgcXVlcnkucGFnZSAqIHF1ZXJ5LmxpbWl0IC0gMSk7XG5cbiAgICAgICAgLy8gQXBwbHkgZmlsdGVyc1xuICAgICAgICBpZiAocXVlcnkuY2F0ZWdvcnkpIHtcbiAgICAgICAgICBzaW1wbGVRdWVyeSA9IHNpbXBsZVF1ZXJ5LmVxKCdjYXRlZ29yeScsIHF1ZXJ5LmNhdGVnb3J5KTtcbiAgICAgICAgfVxuICAgICAgICBpZiAocXVlcnkuYXV0aG9yX2lkKSB7XG4gICAgICAgICAgc2ltcGxlUXVlcnkgPSBzaW1wbGVRdWVyeS5lcSgnYXV0aG9yX2lkJywgcXVlcnkuYXV0aG9yX2lkKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAocXVlcnkuc3RhcnRfZGF0ZSkge1xuICAgICAgICAgIHNpbXBsZVF1ZXJ5ID0gc2ltcGxlUXVlcnkuZ3RlKCdwdWJsaXNoZWRfYXQnLCBxdWVyeS5zdGFydF9kYXRlKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAocXVlcnkuZW5kX2RhdGUpIHtcbiAgICAgICAgICBzaW1wbGVRdWVyeSA9IHNpbXBsZVF1ZXJ5Lmx0ZSgncHVibGlzaGVkX2F0JywgcXVlcnkuZW5kX2RhdGUpO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgeyBkYXRhOiBzaW1wbGVSZXN1bHRzLCBlcnJvcjogc2ltcGxlRXJyb3IsIGNvdW50IH0gPSBhd2FpdCBzaW1wbGVRdWVyeTtcblxuICAgICAgICBpZiAoc2ltcGxlRXJyb3IpIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFNpbXBsZSBmYWxsYmFjayBlcnJvcjogJHtzaW1wbGVFcnJvci5tZXNzYWdlfWApO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gVHJhbnNmb3JtIHJlc3VsdHMgdG8gaW5jbHVkZSBjb21tZW50IGNvdW50IChyZXF1aXJlcyBzZXBhcmF0ZSBxdWVyeSlcbiAgICAgICAgY29uc3QgbmV3c1dpdGhDb21tZW50cyA9IGF3YWl0IFByb21pc2UuYWxsKFxuICAgICAgICAgIChzaW1wbGVSZXN1bHRzIHx8IFtdKS5tYXAoYXN5bmMgKG5ld3M6IGFueSkgPT4ge1xuICAgICAgICAgICAgY29uc3QgeyBkYXRhOiBjb21tZW50cyB9ID0gYXdhaXQgc3VwYWJhc2VTZXJ2aWNlXG4gICAgICAgICAgICAgIC5mcm9tKCdjb21tZW50cycpXG4gICAgICAgICAgICAgIC5zZWxlY3QoJ2lkJywgeyBjb3VudDogJ2V4YWN0JyB9KVxuICAgICAgICAgICAgICAuZXEoJ25ld3NfaWQnLCBuZXdzLmlkKVxuICAgICAgICAgICAgICAuZXEoJ3BhcmVudF9jb21tZW50X2lkJywgbnVsbCk7XG5cbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgIC4uLm5ld3MsXG4gICAgICAgICAgICAgIGNvbW1lbnRfY291bnQ6IGNvbW1lbnRzPy5sZW5ndGggfHwgMCxcbiAgICAgICAgICAgICAgYXV0aG9yX25hbWU6IG5ld3MucHJvZmlsZXM/LmZ1bGxfbmFtZSB8fCAnVW5rbm93bicsXG4gICAgICAgICAgICAgIGF1dGhvcl9lbWFpbDogbmV3cy5wcm9maWxlcz8uZW1haWwgfHwgbnVsbFxuICAgICAgICAgICAgfTtcbiAgICAgICAgICB9KVxuICAgICAgICApO1xuXG4gICAgICAgIGNvbnN0IHJlc3BvbnNlID0ge1xuICAgICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgICAgZGF0YTogbmV3c1dpdGhDb21tZW50cyxcbiAgICAgICAgICBwYWdpbmF0aW9uOiB7XG4gICAgICAgICAgICBwYWdlOiBxdWVyeS5wYWdlLFxuICAgICAgICAgICAgbGltaXQ6IHF1ZXJ5LmxpbWl0LFxuICAgICAgICAgICAgdG90YWxfcmVzdWx0czogY291bnQgfHwgMCxcbiAgICAgICAgICAgIHRvdGFsX3BhZ2VzOiBNYXRoLmNlaWwoKGNvdW50IHx8IDApIC8gcXVlcnkubGltaXQpXG4gICAgICAgICAgfSxcbiAgICAgICAgICBmaWx0ZXJzOiB7XG4gICAgICAgICAgICBjYXRlZ29yeTogcXVlcnkuY2F0ZWdvcnkgfHwgdW5kZWZpbmVkLFxuICAgICAgICAgICAgYXV0aG9yX2lkOiBxdWVyeS5hdXRob3JfaWQgfHwgdW5kZWZpbmVkLFxuICAgICAgICAgICAgc3RhcnRfZGF0ZTogcXVlcnkuc3RhcnRfZGF0ZSB8fCB1bmRlZmluZWQsXG4gICAgICAgICAgICBlbmRfZGF0ZTogcXVlcnkuZW5kX2RhdGUgfHwgdW5kZWZpbmVkLFxuICAgICAgICAgICAgc2VhcmNoOiBxdWVyeS5zZWFyY2ggfHwgdW5kZWZpbmVkLFxuICAgICAgICAgICAgc29ydF9ieTogcXVlcnkuc29ydF9ieSxcbiAgICAgICAgICAgIHNvcnRfb3JkZXI6IHF1ZXJ5LnNvcnRfb3JkZXJcbiAgICAgICAgICB9LFxuICAgICAgICAgIHBlcmZvcm1hbmNlOiB7XG4gICAgICAgICAgICBleGVjdXRpb25fdGltZV9tczogcGVyZm9ybWFuY2Uubm93KCkgLSBzdGFydFRpbWUsXG4gICAgICAgICAgICBtZXRob2Q6ICdmYWxsYmFja19zaW1wbGUnLFxuICAgICAgICAgICAgcmVxdWVzdF9pZDogcmVxdWVzdElkXG4gICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihyZXNwb25zZSwge1xuICAgICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICAgICdDYWNoZS1Db250cm9sJzogJ3B1YmxpYywgcy1tYXhhZ2U9NjAsIHN0YWxlLXdoaWxlLXJldmFsaWRhdGU9MzAwJyxcbiAgICAgICAgICAgICdYLUNhY2hlJzogJ01JU1MnLFxuICAgICAgICAgICAgJ1gtUmVxdWVzdC1JRCc6IHJlcXVlc3RJZFxuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgIH0gY2F0Y2ggKGZhbGxiYWNrRXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihgWyR7cmVxdWVzdElkfV0gRmFsbGJhY2sgZXJyb3I6YCwgZmFsbGJhY2tFcnJvcik7XG4gICAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAgICB7XG4gICAgICAgICAgICBlcnJvcjogJ0ZhaWxlZCB0byBmZXRjaCBuZXdzJyxcbiAgICAgICAgICAgIGRldGFpbHM6IGZhbGxiYWNrRXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGZhbGxiYWNrRXJyb3IubWVzc2FnZSA6ICdVbmtub3duIGVycm9yJyxcbiAgICAgICAgICAgIHJlcXVlc3RfaWQ6IHJlcXVlc3RJZFxuICAgICAgICAgIH0sXG4gICAgICAgICAgeyBzdGF0dXM6IDUwMCB9XG4gICAgICAgICk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gVHJhbnNmb3JtIHJlc3VsdHMgdG8gZXhwZWN0ZWQgZm9ybWF0XG4gICAgY29uc3QgdHJhbnNmb3JtZWRSZXN1bHRzID0gKHJlc3VsdHMgfHwgW10pLm1hcCgoaXRlbTogYW55KSA9PiAoe1xuICAgICAgaWQ6IGl0ZW0uaWQsXG4gICAgICB0aXRsZTogaXRlbS50aXRsZSxcbiAgICAgIGNvbnRlbnQ6IGl0ZW0uY29udGVudCxcbiAgICAgIGNhdGVnb3J5OiBpdGVtLmNhdGVnb3J5LFxuICAgICAgYXV0aG9yX2lkOiBpdGVtLmF1dGhvcl9pZCxcbiAgICAgIGF1dGhvcl9uYW1lOiBpdGVtLmF1dGhvcl9uYW1lIHx8ICdVbmtub3duJyxcbiAgICAgIGF1dGhvcl9lbWFpbDogaXRlbS5hdXRob3JfZW1haWwgfHwgbnVsbCxcbiAgICAgIGNyZWF0ZWRfYXQ6IGl0ZW0uY3JlYXRlZF9hdCxcbiAgICAgIHB1Ymxpc2hlZF9hdDogaXRlbS5wdWJsaXNoZWRfYXQsXG4gICAgICBpc19wdWJsaXNoZWQ6IGl0ZW0uaXNfcHVibGlzaGVkLFxuICAgICAgY29tbWVudF9jb3VudDogcGFyc2VJbnQoaXRlbS5jb21tZW50X2NvdW50KSB8fCAwXG4gICAgfSkpO1xuXG4gICAgLy8gR2V0IHRvdGFsIGNvdW50IGZvciBwYWdpbmF0aW9uXG4gICAgbGV0IHRvdGFsQ291bnQgPSAwO1xuICAgIGlmIChyZXN1bHRzICYmIHJlc3VsdHMubGVuZ3RoID4gMCkge1xuICAgICAgdG90YWxDb3VudCA9IHBhcnNlSW50KHJlc3VsdHNbMF0udG90YWxfY291bnQpIHx8IHRyYW5zZm9ybWVkUmVzdWx0cy5sZW5ndGg7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRvdGFsQ291bnQgPSB0cmFuc2Zvcm1lZFJlc3VsdHMubGVuZ3RoO1xuICAgIH1cblxuICAgIC8vIEJ1aWxkIHN1Y2Nlc3NmdWwgcmVzcG9uc2VcbiAgICBjb25zdCByZXNwb25zZSA9IHtcbiAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICBkYXRhOiB0cmFuc2Zvcm1lZFJlc3VsdHMsXG4gICAgICBwYWdpbmF0aW9uOiB7XG4gICAgICAgIHBhZ2U6IHF1ZXJ5LnBhZ2UsXG4gICAgICAgIGxpbWl0OiBxdWVyeS5saW1pdCxcbiAgICAgICAgdG90YWxfcmVzdWx0czogdG90YWxDb3VudCxcbiAgICAgICAgdG90YWxfcGFnZXM6IE1hdGguY2VpbCh0b3RhbENvdW50IC8gcXVlcnkubGltaXQpXG4gICAgICB9LFxuICAgICAgZmlsdGVyczoge1xuICAgICAgICBjYXRlZ29yeTogcXVlcnkuY2F0ZWdvcnkgfHwgdW5kZWZpbmVkLFxuICAgICAgICBhdXRob3JfaWQ6IHF1ZXJ5LmF1dGhvcl9pZCB8fCB1bmRlZmluZWQsXG4gICAgICAgIHN0YXJ0X2RhdGU6IHF1ZXJ5LnN0YXJ0X2RhdGUgfHwgdW5kZWZpbmVkLFxuICAgICAgICBlbmRfZGF0ZTogcXVlcnkuZW5kX2RhdGUgfHwgdW5kZWZpbmVkLFxuICAgICAgICBzZWFyY2g6IHF1ZXJ5LnNlYXJjaCB8fCB1bmRlZmluZWQsXG4gICAgICAgIHNvcnRfYnk6IHF1ZXJ5LnNvcnRfYnksXG4gICAgICAgIHNvcnRfb3JkZXI6IHF1ZXJ5LnNvcnRfb3JkZXJcbiAgICAgIH0sXG4gICAgICBwZXJmb3JtYW5jZToge1xuICAgICAgICBleGVjdXRpb25fdGltZV9tczogcGVyZm9ybWFuY2Uubm93KCkgLSBzdGFydFRpbWUsXG4gICAgICAgIG1ldGhvZDogJ29wdGltaXplZF9xdWVyeScsXG4gICAgICAgIHJlcXVlc3RfaWQ6IHJlcXVlc3RJZCxcbiAgICAgICAgY2FjaGVfc3RhdHVzOiAnbWlzcydcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgLy8gQ2FjaGUgdGhlIHJlc3BvbnNlIHVzaW5nIE5leHQuanMgcmV2YWxpZGF0ZVxuICAgIHRyeSB7XG4gICAgICAvLyBVc2luZyBOZXh0LmpzIGNhY2hpbmcgbWVjaGFuaXNtc1xuICAgICAgcmVzcG9uc2UuZnJvbV9jYWNoZSA9IGZhbHNlO1xuICAgIH0gY2F0Y2ggKGNhY2hlRXJyb3IpIHtcbiAgICAgIGNvbnNvbGUud2FybihgWyR7cmVxdWVzdElkfV0gQ2FjaGluZyBmYWlsZWQ6YCwgY2FjaGVFcnJvcik7XG4gICAgfVxuXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHJlc3BvbnNlLCB7XG4gICAgICBoZWFkZXJzOiB7XG4gICAgICAgICdDYWNoZS1Db250cm9sJzogJ3B1YmxpYywgcy1tYXhhZ2U9MzAwLCBzdGFsZS13aGlsZS1yZXZhbGlkYXRlPTYwMCcsXG4gICAgICAgICdFVGFnJzogYFwiJHtjYWNoZUtleX1cImAsXG4gICAgICAgICdMYXN0LU1vZGlmaWVkJzogbmV3IERhdGUoKS50b1VUQ1N0cmluZygpLFxuICAgICAgICAnWC1DYWNoZSc6ICdNSVNTJyxcbiAgICAgICAgJ1gtUmVxdWVzdC1JRCc6IHJlcXVlc3RJZFxuICAgICAgfVxuICAgIH0pO1xuXG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcihgWyR7cmVxdWVzdElkfV0gTmV3cyBBUEkgZXJyb3I6YCwgZXJyb3IpO1xuXG4gICAgLy8gSGFuZGxlIGRpZmZlcmVudCB0eXBlcyBvZiBlcnJvcnNcbiAgICBpZiAoZXJyb3IgaW5zdGFuY2VvZiB6LlpvZEVycm9yKSB7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgIHtcbiAgICAgICAgICBlcnJvcjogJ1ZhbGlkYXRpb24gZXJyb3InLFxuICAgICAgICAgIGRldGFpbHM6ICdJbnZhbGlkIHF1ZXJ5IHBhcmFtZXRlcnMnLFxuICAgICAgICAgIGVycm9yczogZXJyb3IuZXJyb3JzLFxuICAgICAgICAgIHJlcXVlc3RfaWQ6IHJlcXVlc3RJZFxuICAgICAgICB9LFxuICAgICAgICB7IHN0YXR1czogNDAwIH1cbiAgICAgICk7XG4gICAgfVxuXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAge1xuICAgICAgICBlcnJvcjogJ0ludGVybmFsIHNlcnZlciBlcnJvcicsXG4gICAgICAgIGRldGFpbHM6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ1Vua25vd24gZXJyb3InLFxuICAgICAgICByZXF1ZXN0X2lkOiByZXF1ZXN0SWRcbiAgICAgIH0sXG4gICAgICB7IHN0YXR1czogNTAwIH1cbiAgICApO1xuICB9XG59XG5cbi8vIFBPU1QgaGFuZGxlciBmb3IgY3JlYXRpbmcgbmV3cyAoYWRtaW5pc3RyYXRpdmUpXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gUE9TVChyZXF1ZXN0OiBOZXh0UmVxdWVzdCkge1xuICBjb25zdCByZXF1ZXN0SWQgPSBjcnlwdG8ucmFuZG9tVVVJRCgpO1xuXG4gIHRyeSB7XG4gICAgY29uc3QgYm9keSA9IGF3YWl0IHJlcXVlc3QuanNvbigpO1xuICAgIGNvbnN0IHsgdGl0bGUsIGNvbnRlbnQsIGNhdGVnb3J5LCBhdXRob3JfaWQsIHB1Ymxpc2hlZF9hdCB9ID0gYm9keTtcblxuICAgIC8vIEJhc2ljIHZhbGlkYXRpb25cbiAgICBpZiAoIXRpdGxlIHx8IHRpdGxlLnRyaW0oKS5sZW5ndGggPCAzKSB7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgIHtcbiAgICAgICAgICBlcnJvcjogJ1ZhbGlkYXRpb24gZXJyb3InLFxuICAgICAgICAgIG1lc3NhZ2U6ICdUaXRsZSBpcyByZXF1aXJlZCBhbmQgbXVzdCBiZSBhdCBsZWFzdCAzIGNoYXJhY3RlcnMgbG9uZycsXG4gICAgICAgICAgcmVxdWVzdF9pZDogcmVxdWVzdElkXG4gICAgICAgIH0sXG4gICAgICAgIHsgc3RhdHVzOiA0MDAgfVxuICAgICAgKTtcbiAgICB9XG5cbiAgICBpZiAoIWNvbnRlbnQgfHwgY29udGVudC50cmltKCkubGVuZ3RoIDwgMTApIHtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAge1xuICAgICAgICAgIGVycm9yOiAnVmFsaWRhdGlvbiBlcnJvcicsXG4gICAgICAgICAgbWVzc2FnZTogJ0NvbnRlbnQgaXMgcmVxdWlyZWQgYW5kIG11c3QgYmUgYXQgbGVhc3QgMTAgY2hhcmFjdGVycyBsb25nJyxcbiAgICAgICAgICByZXF1ZXN0X2lkOiByZXF1ZXN0SWRcbiAgICAgICAgfSxcbiAgICAgICAgeyBzdGF0dXM6IDQwMCB9XG4gICAgICApO1xuICAgIH1cblxuICAgIC8vIFZhbGlkYXRlIGNhdGVnb3J5IGlmIHByb3ZpZGVkXG4gICAgY29uc3QgdmFsaWRDYXRlZ29yaWVzID0gWyduYXRpb25hbCcsICdpbnRlcm5hdGlvbmFsJywgJ3RlY2hub2xvZ3knLCAnc3BvcnRzJywgJ2N1bHR1cmUnXTtcbiAgICBpZiAoY2F0ZWdvcnkgJiYgIXZhbGlkQ2F0ZWdvcmllcy5pbmNsdWRlcyhjYXRlZ29yeSkpIHtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAge1xuICAgICAgICAgIGVycm9yOiAnVmFsaWRhdGlvbiBlcnJvcicsXG4gICAgICAgICAgbWVzc2FnZTogYEludmFsaWQgY2F0ZWdvcnkuIE11c3QgYmUgb25lIG9mOiAke3ZhbGlkQ2F0ZWdvcmllcy5qb2luKCcsICcpfWAsXG4gICAgICAgICAgcmVxdWVzdF9pZDogcmVxdWVzdElkXG4gICAgICAgIH0sXG4gICAgICAgIHsgc3RhdHVzOiA0MDAgfVxuICAgICAgKTtcbiAgICB9XG5cbiAgICAvLyBDcmVhdGUgbmV3cyBlbnRyeVxuICAgIGNvbnN0IHsgZGF0YTogbmV3TmV3cywgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlU2VydmljZVxuICAgICAgLmZyb20oJ25ld3MnKVxuICAgICAgLmluc2VydChbe1xuICAgICAgICB0aXRsZTogdGl0bGUudHJpbSgpLFxuICAgICAgICBjb250ZW50OiBjb250ZW50LnRyaW0oKSxcbiAgICAgICAgY2F0ZWdvcnksXG4gICAgICAgIGF1dGhvcl9pZDogYXV0aG9yX2lkIHx8IG51bGwsXG4gICAgICAgIHB1Ymxpc2hlZF9hdDogcHVibGlzaGVkX2F0IHx8IG51bGwsXG4gICAgICAgIGlzX3B1Ymxpc2hlZDogZmFsc2UgLy8gRGVmYXVsdCB1bnB1Ymxpc2hlZCBmb3IgYXBwcm92YWxcbiAgICAgIH1dKVxuICAgICAgLnNlbGVjdCgpXG4gICAgICAuc2luZ2xlKCk7XG5cbiAgICBpZiAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoYFske3JlcXVlc3RJZH1dIENyZWF0ZSBuZXdzIGVycm9yOmAsIGVycm9yKTtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAge1xuICAgICAgICAgIGVycm9yOiAnRmFpbGVkIHRvIGNyZWF0ZSBuZXdzJyxcbiAgICAgICAgICBkZXRhaWxzOiBlcnJvci5tZXNzYWdlLFxuICAgICAgICAgIHJlcXVlc3RfaWQ6IHJlcXVlc3RJZFxuICAgICAgICB9LFxuICAgICAgICB7IHN0YXR1czogNTAwIH1cbiAgICAgICk7XG4gICAgfVxuXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHtcbiAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICBkYXRhOiBuZXdOZXdzLFxuICAgICAgbWVzc2FnZTogJ05ld3MgY3JlYXRlZCBzdWNjZXNzZnVsbHkuIEF3YWl0aW5nIGFwcHJvdmFsLicsXG4gICAgICBwZXJmb3JtYW5jZToge1xuICAgICAgICBleGVjdXRpb25fdGltZV9tczogcGVyZm9ybWFuY2Uubm93KCksXG4gICAgICAgIHJlcXVlc3RfaWQ6IHJlcXVlc3RJZFxuICAgICAgfVxuICAgIH0pO1xuXG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcihgWyR7cmVxdWVzdElkfV0gQ3JlYXRlIG5ld3MgQVBJIGVycm9yOmAsIGVycm9yKTtcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICB7XG4gICAgICAgIGVycm9yOiAnSW50ZXJuYWwgc2VydmVyIGVycm9yJyxcbiAgICAgICAgZGV0YWlsczogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnVW5rbm93biBlcnJvcicsXG4gICAgICAgIHJlcXVlc3RfaWQ6IHJlcXVlc3RJZFxuICAgICAgfSxcbiAgICAgIHsgc3RhdHVzOiA1MDAgfVxuICAgICk7XG4gIH1cbn0iXSwibmFtZXMiOlsiTmV4dFJlc3BvbnNlIiwieiIsInN1cGFiYXNlU2VydmljZSIsInJhdGVMaW1pdGVyIiwibmV3c1F1ZXJ5U2NoZW1hIiwib2JqZWN0IiwicGFnZSIsImNvZXJjZSIsIm51bWJlciIsIm1pbiIsIm1heCIsImRlZmF1bHQiLCJsaW1pdCIsImNhdGVnb3J5IiwiZW51bSIsIm9wdGlvbmFsIiwiYXV0aG9yX2lkIiwic3RyaW5nIiwidXVpZCIsInN0YXJ0X2RhdGUiLCJkYXRldGltZSIsImVuZF9kYXRlIiwic2VhcmNoIiwic29ydF9ieSIsInNvcnRfb3JkZXIiLCJnZW5lcmF0ZUNhY2hlS2V5IiwicXVlcnkiLCJrZXlQYXJ0cyIsImpvaW4iLCJidWlsZE5ld3NRdWVyeSIsIm9mZnNldCIsImNvbmRpdGlvbnMiLCJwdXNoIiwiZXNjYXBlVmFsdWUiLCJ3aGVyZUNsYXVzZSIsImxlbmd0aCIsIm9yZGVyQnlDbGF1c2UiLCJ0b1VwcGVyQ2FzZSIsInBhZ2luYXRpb25DbGF1c2UiLCJzcWwiLCJwYXJhbXMiLCJmaWx0ZXIiLCJfIiwiaW5kZXgiLCJpbmNsdWRlcyIsIm1hcCIsImNvbmRpdGlvbiIsInZhbHVlIiwic3BsaXQiLCJ0cmltIiwidW5lc2NhcGVWYWx1ZSIsIkJvb2xlYW4iLCJyZXBsYWNlIiwic3RhcnRzV2l0aCIsImVuZHNXaXRoIiwic2xpY2UiLCJHRVQiLCJyZXF1ZXN0Iiwic3RhcnRUaW1lIiwicGVyZm9ybWFuY2UiLCJub3ciLCJyZXF1ZXN0SWQiLCJjcnlwdG8iLCJyYW5kb21VVUlEIiwiaXAiLCJ1c2VyQWdlbnQiLCJoZWFkZXJzIiwiZ2V0IiwicmF0ZUxpbWl0UmVzdWx0IiwiY2hlY2tMaW1pdCIsImFsbG93ZWQiLCJqc29uIiwiZXJyb3IiLCJtZXNzYWdlIiwicmV0cnlfYWZ0ZXIiLCJsaW1pdEluZm8iLCJyZXRyeUFmdGVyIiwicmVxdWVzdF9pZCIsInN0YXR1cyIsIkRhdGUiLCJ0b1VUQ1N0cmluZyIsInRvU3RyaW5nIiwic2VhcmNoUGFyYW1zIiwibmV4dFVybCIsInJhd1F1ZXJ5IiwiT2JqZWN0IiwiZnJvbUVudHJpZXMiLCJlbnRyaWVzIiwicGFyc2UiLCJjYWNoZUtleSIsImNhY2hlZERhdGEiLCJmZXRjaCIsInByb2Nlc3MiLCJlbnYiLCJORVhUX1BVQkxJQ19TVVBBQkFTRV9VUkwiLCJhcGlrZXkiLCJORVhUX1BVQkxJQ19TVVBBQkFTRV9BTk9OX0tFWSIsIkF1dGhvcml6YXRpb24iLCJvayIsImNhY2hlZFJlc3BvbnNlIiwiZnJvbV9jYWNoZSIsImV4ZWN1dGlvbl90aW1lX21zIiwibWV0aG9kIiwiY2FjaGVFcnJvciIsImNvbnNvbGUiLCJ3YXJuIiwibG9nIiwiZGF0YSIsInJlc3VsdHMiLCJycGMiLCJKU09OIiwic3RyaW5naWZ5Iiwic2ltcGxlUXVlcnkiLCJmcm9tIiwic2VsZWN0IiwiY291bnQiLCJlcSIsIm9yZGVyIiwiYXNjZW5kaW5nIiwicmFuZ2UiLCJndGUiLCJsdGUiLCJzaW1wbGVSZXN1bHRzIiwic2ltcGxlRXJyb3IiLCJFcnJvciIsIm5ld3NXaXRoQ29tbWVudHMiLCJQcm9taXNlIiwiYWxsIiwibmV3cyIsImNvbW1lbnRzIiwiaWQiLCJjb21tZW50X2NvdW50IiwiYXV0aG9yX25hbWUiLCJwcm9maWxlcyIsImZ1bGxfbmFtZSIsImF1dGhvcl9lbWFpbCIsImVtYWlsIiwicmVzcG9uc2UiLCJzdWNjZXNzIiwicGFnaW5hdGlvbiIsInRvdGFsX3Jlc3VsdHMiLCJ0b3RhbF9wYWdlcyIsIk1hdGgiLCJjZWlsIiwiZmlsdGVycyIsInVuZGVmaW5lZCIsImZhbGxiYWNrRXJyb3IiLCJkZXRhaWxzIiwidHJhbnNmb3JtZWRSZXN1bHRzIiwiaXRlbSIsInRpdGxlIiwiY29udGVudCIsImNyZWF0ZWRfYXQiLCJwdWJsaXNoZWRfYXQiLCJpc19wdWJsaXNoZWQiLCJwYXJzZUludCIsInRvdGFsQ291bnQiLCJ0b3RhbF9jb3VudCIsImNhY2hlX3N0YXR1cyIsIlpvZEVycm9yIiwiZXJyb3JzIiwiUE9TVCIsImJvZHkiLCJ2YWxpZENhdGVnb3JpZXMiLCJuZXdOZXdzIiwiaW5zZXJ0Iiwic2luZ2xlIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/app/api/news/route.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/rateLimiter.ts":
/*!********************************!*\
  !*** ./src/lib/rateLimiter.ts ***!
  \********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   AdaptiveRateLimiter: () => (/* binding */ AdaptiveRateLimiter),\n/* harmony export */   RateLimiter: () => (/* binding */ RateLimiter),\n/* harmony export */   adaptiveRateLimiter: () => (/* binding */ adaptiveRateLimiter),\n/* harmony export */   rateLimiter: () => (/* binding */ rateLimiter)\n/* harmony export */ });\n/* harmony import */ var crypto__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! crypto */ \"crypto\");\n/* harmony import */ var crypto__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(crypto__WEBPACK_IMPORTED_MODULE_0__);\n\n/**\n * Multi-strategy Rate Limiter\n * - Sliding Window Counter\n * - Token Bucket\n * - Fixed Window\n * - Adaptive Rate Limiting\n */ class RateLimiter {\n    constructor(){\n        this.stores = new Map();\n        this.configs = new Map();\n        this.metrics = {\n            totalRequests: 0,\n            blockedRequests: 0,\n            suspiciousActivity: 0,\n            averageResponseTime: 0,\n            topBlockedIPs: [],\n            topEndpoints: []\n        };\n        this.startCleanupInterval();\n    }\n    /**\n   * Configure rate limiting for a specific route or pattern\n   */ configure(pattern, config) {\n        this.configs.set(pattern, config);\n    }\n    /**\n   * Check if request is allowed\n   */ async checkLimit(req, pattern) {\n        const startTime = performance.now();\n        this.metrics.totalRequests++;\n        try {\n            const config = this.configs.get(pattern);\n            if (!config) {\n                return {\n                    allowed: true\n                };\n            }\n            const key = config.keyGenerator ? config.keyGenerator(req) : this.defaultKeyGenerator(req);\n            const store = this.getStore(pattern);\n            const now = Date.now();\n            // Clean expired entries\n            this.cleanupExpiredEntries(store, now);\n            // Get current limit info\n            const current = store.get(key) || {\n                count: 0,\n                resetTime: now + config.windowMs\n            };\n            // Check if window has reset\n            if (now > current.resetTime) {\n                current.count = 0;\n                current.resetTime = now + config.windowMs;\n            }\n            // Increment counter\n            current.count++;\n            // Update store\n            store.set(key, current);\n            const limitInfo = {\n                key,\n                current: current.count,\n                max: config.maxRequests,\n                remaining: Math.max(0, config.maxRequests - current.count),\n                resetTime: current.resetTime,\n                retryAfter: Math.ceil((current.resetTime - now) / 1000)\n            };\n            // Check if limit exceeded\n            const isLimited = current.count > config.maxRequests;\n            if (isLimited) {\n                this.metrics.blockedRequests++;\n                this.updateBlockedIPs(req.ip);\n                this.updateBlockedEndpoints(req.url, pattern);\n                // Call limit reached callback\n                if (config.onLimitReached) {\n                    config.onLimitReached(key, limitInfo);\n                }\n            }\n            // Update metrics\n            const responseTime = performance.now() - startTime;\n            this.updateMetrics(responseTime, req.ip, req.url, isLimited);\n            return {\n                allowed: !isLimited,\n                limitInfo: isLimited ? limitInfo : undefined\n            };\n        } catch (error) {\n            console.error(\"Rate limit check failed:\", error);\n            return {\n                allowed: true\n            }; // Fail open for security\n        }\n    }\n    /**\n   * Get current metrics\n   */ getMetrics() {\n        // Calculate top blocked IPs\n        const sortedIPs = [\n            ...this.metrics.topBlockedIPs\n        ].sort((a, b)=>b.count - a.count).slice(0, 10);\n        // Calculate top endpoints\n        const sortedEndpoints = [\n            ...this.metrics.topEndpoints\n        ].sort((a, b)=>b.blocked - a.blocked).slice(0, 10);\n        return {\n            ...this.metrics,\n            topBlockedIPs: sortedIPs,\n            topEndpoints: sortedEndpoints\n        };\n    }\n    /**\n   * Reset metrics\n   */ resetMetrics() {\n        this.metrics = {\n            totalRequests: 0,\n            blockedRequests: 0,\n            suspiciousActivity: 0,\n            averageResponseTime: 0,\n            topBlockedIPs: [],\n            topEndpoints: []\n        };\n    }\n    /**\n   * Get store for pattern\n   */ getStore(pattern) {\n        if (!this.stores.has(pattern)) {\n            this.stores.set(pattern, new Map());\n        }\n        return this.stores.get(pattern);\n    }\n    /**\n   * Default key generator\n   */ defaultKeyGenerator(req) {\n        const ip = req.ip || \"unknown\";\n        const userAgent = req.headers[\"user-agent\"] || \"unknown\";\n        const hash = (0,crypto__WEBPACK_IMPORTED_MODULE_0__.createHash)(\"md5\").update(`${ip}:${userAgent}`).digest(\"hex\");\n        return hash;\n    }\n    /**\n   * Clean expired entries\n   */ cleanupExpiredEntries(store, now) {\n        for (const [key, entry] of store.entries()){\n            if (now > entry.resetTime) {\n                store.delete(key);\n            }\n        }\n    }\n    /**\n   * Update security metrics\n   */ updateMetrics(responseTime, ip, endpoint, blocked) {\n        // Update average response time\n        this.metrics.averageResponseTime = this.metrics.averageResponseTime * 0.9 + responseTime * 0.1;\n        // Update top blocked IPs\n        const ipEntry = this.metrics.topBlockedIPs.find((p)=>p.ip === ip);\n        if (blocked) {\n            if (ipEntry) {\n                ipEntry.count++;\n                ipEntry.lastBlocked = Date.now();\n            } else {\n                this.metrics.topBlockedIPs.push({\n                    ip,\n                    count: 1,\n                    lastBlocked: Date.now()\n                });\n            }\n        }\n        // Update top endpoints\n        const endpointEntry = this.metrics.topEndpoints.find((e)=>e.endpoint === endpoint);\n        if (endpointEntry) {\n            endpointEntry.count++;\n            if (blocked) {\n                endpointEntry.blocked++;\n            }\n        } else {\n            this.metrics.topEndpoints.push({\n                endpoint,\n                count: 1,\n                blocked: blocked ? 1 : 0\n            });\n        }\n    }\n    /**\n   * Update blocked IPs tracking\n   */ updateBlockedIPs(ip) {\n        // Additional suspicious activity detection\n        if (this.isSuspiciousIP(ip)) {\n            this.metrics.suspiciousActivity++;\n        }\n    }\n    /**\n   * Update blocked endpoints tracking\n   */ updateBlockedEndpoints(url, pattern) {\n        // Pattern-based suspicious activity detection\n        const suspiciousPatterns = [\n            \"/api/auth/login\",\n            \"/api/users\",\n            \"/api/roles\",\n            \"/admin\",\n            \"/wp-admin\",\n            \"/phpmyadmin\"\n        ];\n        if (suspiciousPatterns.some((pattern)=>url.includes(pattern))) {\n            this.metrics.suspiciousActivity++;\n        }\n    }\n    /**\n   * Check if IP is suspicious\n   */ isSuspiciousIP(ip) {\n        // Check if IP appears in blocked list multiple times\n        const ipEntry = this.metrics.topBlockedIPs.find((p)=>p.ip === ip);\n        return ipEntry ? ipEntry.count > 5 : false;\n    }\n    /**\n   * Start cleanup interval\n   */ startCleanupInterval() {\n        this.cleanupInterval = setInterval(()=>{\n            const now = Date.now();\n            for (const [pattern, store] of this.stores.entries()){\n                this.cleanupExpiredEntries(store, now);\n            }\n        }, 60 * 1000); // Clean every minute\n    }\n    /**\n   * Graceful shutdown\n   */ async shutdown() {\n        if (this.cleanupInterval) {\n            clearInterval(this.cleanupInterval);\n        }\n    }\n}\n/**\n * Adaptive Rate Limiter with Machine Learning\n * Analyzes patterns and adjusts limits dynamically\n */ class AdaptiveRateLimiter extends RateLimiter {\n    constructor(){\n        super();\n        this.userBehavior = new Map();\n        this.mlModel = new SimpleMLModel();\n    }\n    async checkLimit(req, pattern) {\n        const userKey = this.getUserKey(req);\n        const behavior = this.getUserBehavior(userKey);\n        // Analyze user behavior\n        const riskScore = this.calculateRiskScore(behavior, req);\n        // Adjust limits based on risk score\n        const adjustedConfig = this.adjustConfigByRisk(pattern, riskScore);\n        // Store behavior for ML training\n        this.storeBehavior(userKey, behavior, req);\n        return super.checkLimit(req, pattern);\n    }\n    /**\n   * Get user identifier\n   */ getUserKey(req) {\n        const ip = req.ip || \"unknown\";\n        const userAgent = req.headers[\"user-agent\"] || \"unknown\";\n        const timestamp = Date.now();\n        const hour = Math.floor(timestamp / (60 * 60 * 1000));\n        return `${ip}:${userAgent}:${hour}`;\n    }\n    /**\n   * Get or create user behavior\n   */ getUserBehavior(userKey) {\n        if (!this.userBehavior.has(userKey)) {\n            this.userBehavior.set(userKey, {\n                requestCount: 0,\n                averageInterval: 0,\n                suspiciousPatterns: 0,\n                lastActivity: Date.now(),\n                trusted: false\n            });\n        }\n        return this.userBehavior.get(userKey);\n    }\n    /**\n   * Calculate risk score\n   */ calculateRiskScore(behavior, req) {\n        let score = 0;\n        // Request frequency\n        if (behavior.requestCount > 100) score += 0.3;\n        else if (behavior.requestCount > 50) score += 0.2;\n        else if (behavior.requestCount > 10) score += 0.1;\n        // Request intervals\n        const now = Date.now();\n        const timeSinceLastActivity = now - behavior.lastActivity;\n        if (timeSinceLastActivity < 1000) score += 0.3; // Rapid requests\n        else if (timeSinceLastActivity < 5000) score += 0.1;\n        // Suspicious patterns\n        score += behavior.suspiciousPatterns * 0.2;\n        // Request headers\n        const headers = req.headers;\n        if (headers[\"user-agent\"]?.toLowerCase().includes(\"bot\")) score += 0.2;\n        if (headers[\"x-forwarded-for\"]) score += 0.1;\n        return Math.min(score, 1.0);\n    }\n    /**\n   * Adjust config based on risk score\n   */ adjustConfigByRisk(pattern, riskScore) {\n        const baseConfig = this.configs.get(pattern);\n        if (!baseConfig) return baseConfig;\n        const multiplier = 1 - riskScore * 0.5; // Reduce limit by up to 50%\n        return {\n            ...baseConfig,\n            maxRequests: Math.floor(baseConfig.maxRequests * multiplier)\n        };\n    }\n    /**\n   * Store user behavior for ML\n   */ storeBehavior(userKey, behavior, req) {\n        behavior.requestCount++;\n        behavior.lastActivity = Date.now();\n        // Detect suspicious patterns\n        if (this.isSuspiciousRequest(req)) {\n            behavior.suspiciousPatterns++;\n        }\n        // Train ML model periodically\n        if (behavior.requestCount % 10 === 0) {\n            this.mlModel.train(behavior, req);\n        }\n    }\n    /**\n   * Check if request is suspicious\n   */ isSuspiciousRequest(req) {\n        const url = req.url?.toLowerCase() || \"\";\n        const headers = req.headers;\n        const suspiciousPatterns = [\n            \"admin\",\n            \"wp-login\",\n            \"phpmyadmin\",\n            \".env\",\n            \"config\",\n            \"backup\"\n        ];\n        return suspiciousPatterns.some((pattern)=>url.includes(pattern));\n    }\n}\n/**\n * Simple ML Model for behavior analysis\n */ class SimpleMLModel {\n    train(behavior, req) {\n        // Simple pattern recognition\n        const key = `${behavior.requestCount}:${behavior.suspiciousPatterns}`;\n        const current = this.patterns.get(key) || 0;\n        this.patterns.set(key, current + 1);\n    }\n    predict(behavior) {\n        const key = `${behavior.requestCount}:${behavior.suspiciousPatterns}`;\n        return this.patterns.get(key) || 0;\n    }\n    constructor(){\n        this.patterns = new Map();\n    }\n}\n// Export global instances\nconst rateLimiter = new RateLimiter();\nconst adaptiveRateLimiter = new AdaptiveRateLimiter();\n// Pre-configure common rate limits\nrateLimiter.configure(\"/api/auth/login\", {\n    windowMs: 15 * 60 * 1000,\n    maxRequests: 5,\n    onLimitReached: (key, limit)=>{\n        console.warn(`Login limit reached for key: ${key}`);\n    }\n});\nrateLimiter.configure(\"/api/auth\", {\n    windowMs: 60 * 60 * 1000,\n    maxRequests: 10,\n    onLimitReached: (key, limit)=>{\n        console.warn(`Auth limit reached for key: ${key}`);\n    }\n});\nrateLimiter.configure(\"/api/roles\", {\n    windowMs: 60 * 60 * 1000,\n    maxRequests: 20,\n    onLimitReached: (key, limit)=>{\n        console.warn(`Roles limit reached for key: ${key}`);\n    }\n});\nrateLimiter.configure(\"/api/users\", {\n    windowMs: 60 * 60 * 1000,\n    maxRequests: 50,\n    onLimitReached: (key, limit)=>{\n        console.warn(`Users limit reached for key: ${key}`);\n    }\n});\nrateLimiter.configure(\"/admin\", {\n    windowMs: 60 * 60 * 1000,\n    maxRequests: 30,\n    onLimitReached: (key, limit)=>{\n        console.warn(`Admin limit reached for key: ${key}`);\n    }\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUNsQ3FCLFVBQVUsS0FBSyxLQUFLO0lBQ3BCRyxhQUFhO0lBQ2JVLGdCQUFnQixDQUFDdkIsS0FBSytGO1FBQ3BCbkUsUUFBUW9FLElBQUksQ0FBQyxDQUFDLDZCQUE2QixFQUFFaEcsSUFBSSxDQUFDO0lBQ3BEO0FBQ0Y7QUFFQTZGLFlBQVl4RyxTQUFTLENBQUMsY0FBYztJQUNsQ3FCLFVBQVUsS0FBSyxLQUFLO0lBQ3BCRyxhQUFhO0lBQ2JVLGdCQUFnQixDQUFDdkIsS0FBSytGO1FBQ3BCbkUsUUFBUW9FLElBQUksQ0FBQyxDQUFDLDZCQUE2QixFQUFFaEcsSUFBSSxDQUFDO0lBQ3BEO0FBQ0Y7QUFFQTZGLFlBQVl4RyxTQUFTLENBQUMsVUFBVTtJQUM5QnFCLFVBQVUsS0FBSyxLQUFLO0lBQ3BCRyxhQUFhO0lBQ2JVLGdCQUFnQixDQUFDdkIsS0FBSytGO1FBQ3BCbkUsUUFBUW9FLElBQUksQ0FBQyxDQUFDLDZCQUE2QixFQUFFaEcsSUFBSSxDQUFDO0lBQ3BEO0FBQ0YiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9ub3RpLWVzZXQvLi9zcmMvbGliL3JhdGVMaW1pdGVyLnRzP2Y4MWIiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgY3JlYXRlQ2xpZW50IH0gZnJvbSAnLi9zdXBhYmFzZSc7XG5pbXBvcnQgeyBjcmVhdGVIYXNoIH0gZnJvbSAnY3J5cHRvJztcblxuLyoqXG4gKiBBZHZhbmNlZCBSYXRlIExpbWl0aW5nIFN5c3RlbSBmb3IgU2VjdXJpdHlcbiAqIEltcGxlbWVudHMgbXVsdGlwbGUgc3RyYXRlZ2llcyB0byBwcmV2ZW50IGFidXNlIGFuZCBhdHRhY2tzXG4gKi9cblxuZXhwb3J0IGludGVyZmFjZSBSYXRlTGltaXRDb25maWcge1xuICB3aW5kb3dNczogbnVtYmVyOyAvLyBUaW1lIHdpbmRvdyBpbiBtaWxsaXNlY29uZHNcbiAgbWF4UmVxdWVzdHM6IG51bWJlcjsgLy8gTWF4aW11bSByZXF1ZXN0cyBwZXIgd2luZG93XG4gIGtleUdlbmVyYXRvcj86IChyZXE6IGFueSkgPT4gc3RyaW5nOyAvLyBDdXN0b20ga2V5IGdlbmVyYXRvclxuICBza2lwU3VjY2Vzc2Z1bFJlcXVlc3RzPzogYm9vbGVhbjsgLy8gRG9uJ3QgY291bnQgc3VjY2Vzc2Z1bCByZXF1ZXN0c1xuICBza2lwRmFpbGVkUmVxdWVzdHM/OiBib29sZWFuOyAvLyBEb24ndCBjb3VudCBmYWlsZWQgcmVxdWVzdHNcbiAgb25MaW1pdFJlYWNoZWQ/OiAoa2V5OiBzdHJpbmcsIGxpbWl0OiBSYXRlTGltaXRJbmZvKSA9PiB2b2lkO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFJhdGVMaW1pdEluZm8ge1xuICBrZXk6IHN0cmluZztcbiAgY3VycmVudDogbnVtYmVyO1xuICBtYXg6IG51bWJlcjtcbiAgcmVtYWluaW5nOiBudW1iZXI7XG4gIHJlc2V0VGltZTogbnVtYmVyO1xuICByZXRyeUFmdGVyOiBudW1iZXI7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgU2VjdXJpdHlNZXRyaWNzIHtcbiAgdG90YWxSZXF1ZXN0czogbnVtYmVyO1xuICBibG9ja2VkUmVxdWVzdHM6IG51bWJlcjtcbiAgc3VzcGljaW91c0FjdGl2aXR5OiBudW1iZXI7XG4gIGF2ZXJhZ2VSZXNwb25zZVRpbWU6IG51bWJlcjtcbiAgdG9wQmxvY2tlZElQczogQXJyYXk8eyBpcDogc3RyaW5nOyBjb3VudDogbnVtYmVyOyBsYXN0QmxvY2tlZDogbnVtYmVyIH0+O1xuICB0b3BFbmRwb2ludHM6IEFycmF5PHsgZW5kcG9pbnQ6IHN0cmluZzsgY291bnQ6IG51bWJlcjsgYmxvY2tlZDogbnVtYmVyIH0+O1xufVxuXG4vKipcbiAqIE11bHRpLXN0cmF0ZWd5IFJhdGUgTGltaXRlclxuICogLSBTbGlkaW5nIFdpbmRvdyBDb3VudGVyXG4gKiAtIFRva2VuIEJ1Y2tldFxuICogLSBGaXhlZCBXaW5kb3dcbiAqIC0gQWRhcHRpdmUgUmF0ZSBMaW1pdGluZ1xuICovXG5leHBvcnQgY2xhc3MgUmF0ZUxpbWl0ZXIge1xuICBwcml2YXRlIHN0b3JlcyA9IG5ldyBNYXA8c3RyaW5nLCBNYXA8c3RyaW5nLCB7IGNvdW50OiBudW1iZXI7IHJlc2V0VGltZTogbnVtYmVyIH0+PigpO1xuICBwcml2YXRlIGNvbmZpZ3MgPSBuZXcgTWFwPHN0cmluZywgUmF0ZUxpbWl0Q29uZmlnPigpO1xuICBwcml2YXRlIG1ldHJpY3M6IFNlY3VyaXR5TWV0cmljcztcbiAgcHJpdmF0ZSBjbGVhbnVwSW50ZXJ2YWw/OiBOb2RlSlMuVGltZW91dDtcblxuICBjb25zdHJ1Y3RvcigpIHtcbiAgICB0aGlzLm1ldHJpY3MgPSB7XG4gICAgICB0b3RhbFJlcXVlc3RzOiAwLFxuICAgICAgYmxvY2tlZFJlcXVlc3RzOiAwLFxuICAgICAgc3VzcGljaW91c0FjdGl2aXR5OiAwLFxuICAgICAgYXZlcmFnZVJlc3BvbnNlVGltZTogMCxcbiAgICAgIHRvcEJsb2NrZWRJUHM6IFtdLFxuICAgICAgdG9wRW5kcG9pbnRzOiBbXVxuICAgIH07XG5cbiAgICB0aGlzLnN0YXJ0Q2xlYW51cEludGVydmFsKCk7XG4gIH1cblxuICAvKipcbiAgICogQ29uZmlndXJlIHJhdGUgbGltaXRpbmcgZm9yIGEgc3BlY2lmaWMgcm91dGUgb3IgcGF0dGVyblxuICAgKi9cbiAgY29uZmlndXJlKHBhdHRlcm46IHN0cmluZywgY29uZmlnOiBSYXRlTGltaXRDb25maWcpOiB2b2lkIHtcbiAgICB0aGlzLmNvbmZpZ3Muc2V0KHBhdHRlcm4sIGNvbmZpZyk7XG4gIH1cblxuICAvKipcbiAgICogQ2hlY2sgaWYgcmVxdWVzdCBpcyBhbGxvd2VkXG4gICAqL1xuICBhc3luYyBjaGVja0xpbWl0KHJlcTogYW55LCBwYXR0ZXJuOiBzdHJpbmcpOiBQcm9taXNlPHsgYWxsb3dlZDogYm9vbGVhbjsgbGltaXRJbmZvPzogUmF0ZUxpbWl0SW5mbyB9PiB7XG4gICAgY29uc3Qgc3RhcnRUaW1lID0gcGVyZm9ybWFuY2Uubm93KCk7XG4gICAgdGhpcy5tZXRyaWNzLnRvdGFsUmVxdWVzdHMrKztcblxuICAgIHRyeSB7XG4gICAgICBjb25zdCBjb25maWcgPSB0aGlzLmNvbmZpZ3MuZ2V0KHBhdHRlcm4pO1xuICAgICAgaWYgKCFjb25maWcpIHtcbiAgICAgICAgcmV0dXJuIHsgYWxsb3dlZDogdHJ1ZSB9O1xuICAgICAgfVxuXG4gICAgICBjb25zdCBrZXkgPSBjb25maWcua2V5R2VuZXJhdG9yID8gY29uZmlnLmtleUdlbmVyYXRvcihyZXEpIDogdGhpcy5kZWZhdWx0S2V5R2VuZXJhdG9yKHJlcSk7XG4gICAgICBjb25zdCBzdG9yZSA9IHRoaXMuZ2V0U3RvcmUocGF0dGVybik7XG4gICAgICBjb25zdCBub3cgPSBEYXRlLm5vdygpO1xuXG4gICAgICAvLyBDbGVhbiBleHBpcmVkIGVudHJpZXNcbiAgICAgIHRoaXMuY2xlYW51cEV4cGlyZWRFbnRyaWVzKHN0b3JlLCBub3cpO1xuXG4gICAgICAvLyBHZXQgY3VycmVudCBsaW1pdCBpbmZvXG4gICAgICBjb25zdCBjdXJyZW50ID0gc3RvcmUuZ2V0KGtleSkgfHwgeyBjb3VudDogMCwgcmVzZXRUaW1lOiBub3cgKyBjb25maWcud2luZG93TXMgfTtcblxuICAgICAgLy8gQ2hlY2sgaWYgd2luZG93IGhhcyByZXNldFxuICAgICAgaWYgKG5vdyA+IGN1cnJlbnQucmVzZXRUaW1lKSB7XG4gICAgICAgIGN1cnJlbnQuY291bnQgPSAwO1xuICAgICAgICBjdXJyZW50LnJlc2V0VGltZSA9IG5vdyArIGNvbmZpZy53aW5kb3dNcztcbiAgICAgIH1cblxuICAgICAgLy8gSW5jcmVtZW50IGNvdW50ZXJcbiAgICAgIGN1cnJlbnQuY291bnQrKztcblxuICAgICAgLy8gVXBkYXRlIHN0b3JlXG4gICAgICBzdG9yZS5zZXQoa2V5LCBjdXJyZW50KTtcblxuICAgICAgY29uc3QgbGltaXRJbmZvOiBSYXRlTGltaXRJbmZvID0ge1xuICAgICAgICBrZXksXG4gICAgICAgIGN1cnJlbnQ6IGN1cnJlbnQuY291bnQsXG4gICAgICAgIG1heDogY29uZmlnLm1heFJlcXVlc3RzLFxuICAgICAgICByZW1haW5pbmc6IE1hdGgubWF4KDAsIGNvbmZpZy5tYXhSZXF1ZXN0cyAtIGN1cnJlbnQuY291bnQpLFxuICAgICAgICByZXNldFRpbWU6IGN1cnJlbnQucmVzZXRUaW1lLFxuICAgICAgICByZXRyeUFmdGVyOiBNYXRoLmNlaWwoKGN1cnJlbnQucmVzZXRUaW1lIC0gbm93KSAvIDEwMDApXG4gICAgICB9O1xuXG4gICAgICAvLyBDaGVjayBpZiBsaW1pdCBleGNlZWRlZFxuICAgICAgY29uc3QgaXNMaW1pdGVkID0gY3VycmVudC5jb3VudCA+IGNvbmZpZy5tYXhSZXF1ZXN0cztcblxuICAgICAgaWYgKGlzTGltaXRlZCkge1xuICAgICAgICB0aGlzLm1ldHJpY3MuYmxvY2tlZFJlcXVlc3RzKys7XG4gICAgICAgIHRoaXMudXBkYXRlQmxvY2tlZElQcyhyZXEuaXApO1xuICAgICAgICB0aGlzLnVwZGF0ZUJsb2NrZWRFbmRwb2ludHMocmVxLnVybCwgcGF0dGVybik7XG5cbiAgICAgICAgLy8gQ2FsbCBsaW1pdCByZWFjaGVkIGNhbGxiYWNrXG4gICAgICAgIGlmIChjb25maWcub25MaW1pdFJlYWNoZWQpIHtcbiAgICAgICAgICBjb25maWcub25MaW1pdFJlYWNoZWQoa2V5LCBsaW1pdEluZm8pO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIC8vIFVwZGF0ZSBtZXRyaWNzXG4gICAgICBjb25zdCByZXNwb25zZVRpbWUgPSBwZXJmb3JtYW5jZS5ub3coKSAtIHN0YXJ0VGltZTtcbiAgICAgIHRoaXMudXBkYXRlTWV0cmljcyhyZXNwb25zZVRpbWUsIHJlcS5pcCwgcmVxLnVybCwgaXNMaW1pdGVkKTtcblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgYWxsb3dlZDogIWlzTGltaXRlZCxcbiAgICAgICAgbGltaXRJbmZvOiBpc0xpbWl0ZWQgPyBsaW1pdEluZm8gOiB1bmRlZmluZWRcbiAgICAgIH07XG5cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignUmF0ZSBsaW1pdCBjaGVjayBmYWlsZWQ6JywgZXJyb3IpO1xuICAgICAgcmV0dXJuIHsgYWxsb3dlZDogdHJ1ZSB9OyAvLyBGYWlsIG9wZW4gZm9yIHNlY3VyaXR5XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEdldCBjdXJyZW50IG1ldHJpY3NcbiAgICovXG4gIGdldE1ldHJpY3MoKTogU2VjdXJpdHlNZXRyaWNzIHtcbiAgICAvLyBDYWxjdWxhdGUgdG9wIGJsb2NrZWQgSVBzXG4gICAgY29uc3Qgc29ydGVkSVBzID0gWy4uLnRoaXMubWV0cmljcy50b3BCbG9ja2VkSVBzXVxuICAgICAgLnNvcnQoKGEsIGIpID0+IGIuY291bnQgLSBhLmNvdW50KVxuICAgICAgLnNsaWNlKDAsIDEwKTtcblxuICAgIC8vIENhbGN1bGF0ZSB0b3AgZW5kcG9pbnRzXG4gICAgY29uc3Qgc29ydGVkRW5kcG9pbnRzID0gWy4uLnRoaXMubWV0cmljcy50b3BFbmRwb2ludHNdXG4gICAgICAuc29ydCgoYSwgYikgPT4gYi5ibG9ja2VkIC0gYS5ibG9ja2VkKVxuICAgICAgLnNsaWNlKDAsIDEwKTtcblxuICAgIHJldHVybiB7XG4gICAgICAuLi50aGlzLm1ldHJpY3MsXG4gICAgICB0b3BCbG9ja2VkSVBzOiBzb3J0ZWRJUHMsXG4gICAgICB0b3BFbmRwb2ludHM6IHNvcnRlZEVuZHBvaW50c1xuICAgIH07XG4gIH1cblxuICAvKipcbiAgICogUmVzZXQgbWV0cmljc1xuICAgKi9cbiAgcmVzZXRNZXRyaWNzKCk6IHZvaWQge1xuICAgIHRoaXMubWV0cmljcyA9IHtcbiAgICAgIHRvdGFsUmVxdWVzdHM6IDAsXG4gICAgICBibG9ja2VkUmVxdWVzdHM6IDAsXG4gICAgICBzdXNwaWNpb3VzQWN0aXZpdHk6IDAsXG4gICAgICBhdmVyYWdlUmVzcG9uc2VUaW1lOiAwLFxuICAgICAgdG9wQmxvY2tlZElQczogW10sXG4gICAgICB0b3BFbmRwb2ludHM6IFtdXG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgc3RvcmUgZm9yIHBhdHRlcm5cbiAgICovXG4gIHByaXZhdGUgZ2V0U3RvcmUocGF0dGVybjogc3RyaW5nKTogTWFwPHN0cmluZywgeyBjb3VudDogbnVtYmVyOyByZXNldFRpbWU6IG51bWJlciB9PiB7XG4gICAgaWYgKCF0aGlzLnN0b3Jlcy5oYXMocGF0dGVybikpIHtcbiAgICAgIHRoaXMuc3RvcmVzLnNldChwYXR0ZXJuLCBuZXcgTWFwKCkpO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcy5zdG9yZXMuZ2V0KHBhdHRlcm4pITtcbiAgfVxuXG4gIC8qKlxuICAgKiBEZWZhdWx0IGtleSBnZW5lcmF0b3JcbiAgICovXG4gIHByaXZhdGUgZGVmYXVsdEtleUdlbmVyYXRvcihyZXE6IGFueSk6IHN0cmluZyB7XG4gICAgY29uc3QgaXAgPSByZXEuaXAgfHwgJ3Vua25vd24nO1xuICAgIGNvbnN0IHVzZXJBZ2VudCA9IHJlcS5oZWFkZXJzWyd1c2VyLWFnZW50J10gfHwgJ3Vua25vd24nO1xuICAgIGNvbnN0IGhhc2ggPSBjcmVhdGVIYXNoKCdtZDUnKVxuICAgICAgLnVwZGF0ZShgJHtpcH06JHt1c2VyQWdlbnR9YClcbiAgICAgIC5kaWdlc3QoJ2hleCcpO1xuICAgIHJldHVybiBoYXNoO1xuICB9XG5cbiAgLyoqXG4gICAqIENsZWFuIGV4cGlyZWQgZW50cmllc1xuICAgKi9cbiAgcHJpdmF0ZSBjbGVhbnVwRXhwaXJlZEVudHJpZXMoc3RvcmU6IE1hcDxzdHJpbmcsIHsgY291bnQ6IG51bWJlcjsgcmVzZXRUaW1lOiBudW1iZXIgfT4sIG5vdzogbnVtYmVyKTogdm9pZCB7XG4gICAgZm9yIChjb25zdCBba2V5LCBlbnRyeV0gb2Ygc3RvcmUuZW50cmllcygpKSB7XG4gICAgICBpZiAobm93ID4gZW50cnkucmVzZXRUaW1lKSB7XG4gICAgICAgIHN0b3JlLmRlbGV0ZShrZXkpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBVcGRhdGUgc2VjdXJpdHkgbWV0cmljc1xuICAgKi9cbiAgcHJpdmF0ZSB1cGRhdGVNZXRyaWNzKHJlc3BvbnNlVGltZTogbnVtYmVyLCBpcDogc3RyaW5nLCBlbmRwb2ludDogc3RyaW5nLCBibG9ja2VkOiBib29sZWFuKTogdm9pZCB7XG4gICAgLy8gVXBkYXRlIGF2ZXJhZ2UgcmVzcG9uc2UgdGltZVxuICAgIHRoaXMubWV0cmljcy5hdmVyYWdlUmVzcG9uc2VUaW1lID1cbiAgICAgIHRoaXMubWV0cmljcy5hdmVyYWdlUmVzcG9uc2VUaW1lICogMC45ICsgcmVzcG9uc2VUaW1lICogMC4xO1xuXG4gICAgLy8gVXBkYXRlIHRvcCBibG9ja2VkIElQc1xuICAgIGNvbnN0IGlwRW50cnkgPSB0aGlzLm1ldHJpY3MudG9wQmxvY2tlZElQcy5maW5kKHAgPT4gcC5pcCA9PT0gaXApO1xuICAgIGlmIChibG9ja2VkKSB7XG4gICAgICBpZiAoaXBFbnRyeSkge1xuICAgICAgICBpcEVudHJ5LmNvdW50Kys7XG4gICAgICAgIGlwRW50cnkubGFzdEJsb2NrZWQgPSBEYXRlLm5vdygpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5tZXRyaWNzLnRvcEJsb2NrZWRJUHMucHVzaCh7XG4gICAgICAgICAgaXAsXG4gICAgICAgICAgY291bnQ6IDEsXG4gICAgICAgICAgbGFzdEJsb2NrZWQ6IERhdGUubm93KClcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gVXBkYXRlIHRvcCBlbmRwb2ludHNcbiAgICBjb25zdCBlbmRwb2ludEVudHJ5ID0gdGhpcy5tZXRyaWNzLnRvcEVuZHBvaW50cy5maW5kKGUgPT4gZS5lbmRwb2ludCA9PT0gZW5kcG9pbnQpO1xuICAgIGlmIChlbmRwb2ludEVudHJ5KSB7XG4gICAgICBlbmRwb2ludEVudHJ5LmNvdW50Kys7XG4gICAgICBpZiAoYmxvY2tlZCkge1xuICAgICAgICBlbmRwb2ludEVudHJ5LmJsb2NrZWQrKztcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5tZXRyaWNzLnRvcEVuZHBvaW50cy5wdXNoKHtcbiAgICAgICAgZW5kcG9pbnQsXG4gICAgICAgIGNvdW50OiAxLFxuICAgICAgICBibG9ja2VkOiBibG9ja2VkID8gMSA6IDBcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBVcGRhdGUgYmxvY2tlZCBJUHMgdHJhY2tpbmdcbiAgICovXG4gIHByaXZhdGUgdXBkYXRlQmxvY2tlZElQcyhpcDogc3RyaW5nKTogdm9pZCB7XG4gICAgLy8gQWRkaXRpb25hbCBzdXNwaWNpb3VzIGFjdGl2aXR5IGRldGVjdGlvblxuICAgIGlmICh0aGlzLmlzU3VzcGljaW91c0lQKGlwKSkge1xuICAgICAgdGhpcy5tZXRyaWNzLnN1c3BpY2lvdXNBY3Rpdml0eSsrO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBVcGRhdGUgYmxvY2tlZCBlbmRwb2ludHMgdHJhY2tpbmdcbiAgICovXG4gIHByaXZhdGUgdXBkYXRlQmxvY2tlZEVuZHBvaW50cyh1cmw6IHN0cmluZywgcGF0dGVybjogc3RyaW5nKTogdm9pZCB7XG4gICAgLy8gUGF0dGVybi1iYXNlZCBzdXNwaWNpb3VzIGFjdGl2aXR5IGRldGVjdGlvblxuICAgIGNvbnN0IHN1c3BpY2lvdXNQYXR0ZXJucyA9IFtcbiAgICAgICcvYXBpL2F1dGgvbG9naW4nLFxuICAgICAgJy9hcGkvdXNlcnMnLFxuICAgICAgJy9hcGkvcm9sZXMnLFxuICAgICAgJy9hZG1pbicsXG4gICAgICAnL3dwLWFkbWluJyxcbiAgICAgICcvcGhwbXlhZG1pbidcbiAgICBdO1xuXG4gICAgaWYgKHN1c3BpY2lvdXNQYXR0ZXJucy5zb21lKHBhdHRlcm4gPT4gdXJsLmluY2x1ZGVzKHBhdHRlcm4pKSkge1xuICAgICAgdGhpcy5tZXRyaWNzLnN1c3BpY2lvdXNBY3Rpdml0eSsrO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBDaGVjayBpZiBJUCBpcyBzdXNwaWNpb3VzXG4gICAqL1xuICBwcml2YXRlIGlzU3VzcGljaW91c0lQKGlwOiBzdHJpbmcpOiBib29sZWFuIHtcbiAgICAvLyBDaGVjayBpZiBJUCBhcHBlYXJzIGluIGJsb2NrZWQgbGlzdCBtdWx0aXBsZSB0aW1lc1xuICAgIGNvbnN0IGlwRW50cnkgPSB0aGlzLm1ldHJpY3MudG9wQmxvY2tlZElQcy5maW5kKHAgPT4gcC5pcCA9PT0gaXApO1xuICAgIHJldHVybiBpcEVudHJ5ID8gaXBFbnRyeS5jb3VudCA+IDUgOiBmYWxzZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTdGFydCBjbGVhbnVwIGludGVydmFsXG4gICAqL1xuICBwcml2YXRlIHN0YXJ0Q2xlYW51cEludGVydmFsKCk6IHZvaWQge1xuICAgIHRoaXMuY2xlYW51cEludGVydmFsID0gc2V0SW50ZXJ2YWwoKCkgPT4ge1xuICAgICAgY29uc3Qgbm93ID0gRGF0ZS5ub3coKTtcbiAgICAgIGZvciAoY29uc3QgW3BhdHRlcm4sIHN0b3JlXSBvZiB0aGlzLnN0b3Jlcy5lbnRyaWVzKCkpIHtcbiAgICAgICAgdGhpcy5jbGVhbnVwRXhwaXJlZEVudHJpZXMoc3RvcmUsIG5vdyk7XG4gICAgICB9XG4gICAgfSwgNjAgKiAxMDAwKTsgLy8gQ2xlYW4gZXZlcnkgbWludXRlXG4gIH1cblxuICAvKipcbiAgICogR3JhY2VmdWwgc2h1dGRvd25cbiAgICovXG4gIGFzeW5jIHNodXRkb3duKCk6IFByb21pc2U8dm9pZD4ge1xuICAgIGlmICh0aGlzLmNsZWFudXBJbnRlcnZhbCkge1xuICAgICAgY2xlYXJJbnRlcnZhbCh0aGlzLmNsZWFudXBJbnRlcnZhbCk7XG4gICAgfVxuICB9XG59XG5cbi8qKlxuICogQWRhcHRpdmUgUmF0ZSBMaW1pdGVyIHdpdGggTWFjaGluZSBMZWFybmluZ1xuICogQW5hbHl6ZXMgcGF0dGVybnMgYW5kIGFkanVzdHMgbGltaXRzIGR5bmFtaWNhbGx5XG4gKi9cbmV4cG9ydCBjbGFzcyBBZGFwdGl2ZVJhdGVMaW1pdGVyIGV4dGVuZHMgUmF0ZUxpbWl0ZXIge1xuICBwcml2YXRlIHVzZXJCZWhhdmlvciA9IG5ldyBNYXA8c3RyaW5nLCB7XG4gICAgcmVxdWVzdENvdW50OiBudW1iZXI7XG4gICAgYXZlcmFnZUludGVydmFsOiBudW1iZXI7XG4gICAgc3VzcGljaW91c1BhdHRlcm5zOiBudW1iZXI7XG4gICAgbGFzdEFjdGl2aXR5OiBudW1iZXI7XG4gICAgdHJ1c3RlZDogYm9vbGVhbjtcbiAgfT4oKTtcbiAgcHJpdmF0ZSBtbE1vZGVsOiBTaW1wbGVNTE1vZGVsO1xuXG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIHN1cGVyKCk7XG4gICAgdGhpcy5tbE1vZGVsID0gbmV3IFNpbXBsZU1MTW9kZWwoKTtcbiAgfVxuXG4gIGFzeW5jIGNoZWNrTGltaXQocmVxOiBhbnksIHBhdHRlcm46IHN0cmluZyk6IFByb21pc2U8eyBhbGxvd2VkOiBib29sZWFuOyBsaW1pdEluZm8/OiBSYXRlTGltaXRJbmZvIH0+IHtcbiAgICBjb25zdCB1c2VyS2V5ID0gdGhpcy5nZXRVc2VyS2V5KHJlcSk7XG4gICAgY29uc3QgYmVoYXZpb3IgPSB0aGlzLmdldFVzZXJCZWhhdmlvcih1c2VyS2V5KTtcblxuICAgIC8vIEFuYWx5emUgdXNlciBiZWhhdmlvclxuICAgIGNvbnN0IHJpc2tTY29yZSA9IHRoaXMuY2FsY3VsYXRlUmlza1Njb3JlKGJlaGF2aW9yLCByZXEpO1xuXG4gICAgLy8gQWRqdXN0IGxpbWl0cyBiYXNlZCBvbiByaXNrIHNjb3JlXG4gICAgY29uc3QgYWRqdXN0ZWRDb25maWcgPSB0aGlzLmFkanVzdENvbmZpZ0J5UmlzayhwYXR0ZXJuLCByaXNrU2NvcmUpO1xuXG4gICAgLy8gU3RvcmUgYmVoYXZpb3IgZm9yIE1MIHRyYWluaW5nXG4gICAgdGhpcy5zdG9yZUJlaGF2aW9yKHVzZXJLZXksIGJlaGF2aW9yLCByZXEpO1xuXG4gICAgcmV0dXJuIHN1cGVyLmNoZWNrTGltaXQocmVxLCBwYXR0ZXJuKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgdXNlciBpZGVudGlmaWVyXG4gICAqL1xuICBwcml2YXRlIGdldFVzZXJLZXkocmVxOiBhbnkpOiBzdHJpbmcge1xuICAgIGNvbnN0IGlwID0gcmVxLmlwIHx8ICd1bmtub3duJztcbiAgICBjb25zdCB1c2VyQWdlbnQgPSByZXEuaGVhZGVyc1sndXNlci1hZ2VudCddIHx8ICd1bmtub3duJztcbiAgICBjb25zdCB0aW1lc3RhbXAgPSBEYXRlLm5vdygpO1xuICAgIGNvbnN0IGhvdXIgPSBNYXRoLmZsb29yKHRpbWVzdGFtcCAvICg2MCAqIDYwICogMTAwMCkpO1xuXG4gICAgcmV0dXJuIGAke2lwfToke3VzZXJBZ2VudH06JHtob3VyfWA7XG4gIH1cblxuICAvKipcbiAgICogR2V0IG9yIGNyZWF0ZSB1c2VyIGJlaGF2aW9yXG4gICAqL1xuICBwcml2YXRlIGdldFVzZXJCZWhhdmlvcih1c2VyS2V5OiBzdHJpbmcpOiBhbnkge1xuICAgIGlmICghdGhpcy51c2VyQmVoYXZpb3IuaGFzKHVzZXJLZXkpKSB7XG4gICAgICB0aGlzLnVzZXJCZWhhdmlvci5zZXQodXNlcktleSwge1xuICAgICAgICByZXF1ZXN0Q291bnQ6IDAsXG4gICAgICAgIGF2ZXJhZ2VJbnRlcnZhbDogMCxcbiAgICAgICAgc3VzcGljaW91c1BhdHRlcm5zOiAwLFxuICAgICAgICBsYXN0QWN0aXZpdHk6IERhdGUubm93KCksXG4gICAgICAgIHRydXN0ZWQ6IGZhbHNlXG4gICAgICB9KTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMudXNlckJlaGF2aW9yLmdldCh1c2VyS2V5KSE7XG4gIH1cblxuICAvKipcbiAgICogQ2FsY3VsYXRlIHJpc2sgc2NvcmVcbiAgICovXG4gIHByaXZhdGUgY2FsY3VsYXRlUmlza1Njb3JlKGJlaGF2aW9yOiBhbnksIHJlcTogYW55KTogbnVtYmVyIHtcbiAgICBsZXQgc2NvcmUgPSAwO1xuXG4gICAgLy8gUmVxdWVzdCBmcmVxdWVuY3lcbiAgICBpZiAoYmVoYXZpb3IucmVxdWVzdENvdW50ID4gMTAwKSBzY29yZSArPSAwLjM7XG4gICAgZWxzZSBpZiAoYmVoYXZpb3IucmVxdWVzdENvdW50ID4gNTApIHNjb3JlICs9IDAuMjtcbiAgICBlbHNlIGlmIChiZWhhdmlvci5yZXF1ZXN0Q291bnQgPiAxMCkgc2NvcmUgKz0gMC4xO1xuXG4gICAgLy8gUmVxdWVzdCBpbnRlcnZhbHNcbiAgICBjb25zdCBub3cgPSBEYXRlLm5vdygpO1xuICAgIGNvbnN0IHRpbWVTaW5jZUxhc3RBY3Rpdml0eSA9IG5vdyAtIGJlaGF2aW9yLmxhc3RBY3Rpdml0eTtcbiAgICBpZiAodGltZVNpbmNlTGFzdEFjdGl2aXR5IDwgMTAwMCkgc2NvcmUgKz0gMC4zOyAvLyBSYXBpZCByZXF1ZXN0c1xuICAgIGVsc2UgaWYgKHRpbWVTaW5jZUxhc3RBY3Rpdml0eSA8IDUwMDApIHNjb3JlICs9IDAuMTtcblxuICAgIC8vIFN1c3BpY2lvdXMgcGF0dGVybnNcbiAgICBzY29yZSArPSBiZWhhdmlvci5zdXNwaWNpb3VzUGF0dGVybnMgKiAwLjI7XG5cbiAgICAvLyBSZXF1ZXN0IGhlYWRlcnNcbiAgICBjb25zdCBoZWFkZXJzID0gcmVxLmhlYWRlcnM7XG4gICAgaWYgKGhlYWRlcnNbJ3VzZXItYWdlbnQnXT8udG9Mb3dlckNhc2UoKS5pbmNsdWRlcygnYm90JykpIHNjb3JlICs9IDAuMjtcbiAgICBpZiAoaGVhZGVyc1sneC1mb3J3YXJkZWQtZm9yJ10pIHNjb3JlICs9IDAuMTtcblxuICAgIHJldHVybiBNYXRoLm1pbihzY29yZSwgMS4wKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBBZGp1c3QgY29uZmlnIGJhc2VkIG9uIHJpc2sgc2NvcmVcbiAgICovXG4gIHByaXZhdGUgYWRqdXN0Q29uZmlnQnlSaXNrKHBhdHRlcm46IHN0cmluZywgcmlza1Njb3JlOiBudW1iZXIpOiBSYXRlTGltaXRDb25maWcge1xuICAgIGNvbnN0IGJhc2VDb25maWcgPSB0aGlzLmNvbmZpZ3MuZ2V0KHBhdHRlcm4pO1xuICAgIGlmICghYmFzZUNvbmZpZykgcmV0dXJuIGJhc2VDb25maWc7XG5cbiAgICBjb25zdCBtdWx0aXBsaWVyID0gMSAtIChyaXNrU2NvcmUgKiAwLjUpOyAvLyBSZWR1Y2UgbGltaXQgYnkgdXAgdG8gNTAlXG5cbiAgICByZXR1cm4ge1xuICAgICAgLi4uYmFzZUNvbmZpZyxcbiAgICAgIG1heFJlcXVlc3RzOiBNYXRoLmZsb29yKGJhc2VDb25maWcubWF4UmVxdWVzdHMgKiBtdWx0aXBsaWVyKVxuICAgIH07XG4gIH1cblxuICAvKipcbiAgICogU3RvcmUgdXNlciBiZWhhdmlvciBmb3IgTUxcbiAgICovXG4gIHByaXZhdGUgc3RvcmVCZWhhdmlvcih1c2VyS2V5OiBzdHJpbmcsIGJlaGF2aW9yOiBhbnksIHJlcTogYW55KTogdm9pZCB7XG4gICAgYmVoYXZpb3IucmVxdWVzdENvdW50Kys7XG4gICAgYmVoYXZpb3IubGFzdEFjdGl2aXR5ID0gRGF0ZS5ub3coKTtcblxuICAgIC8vIERldGVjdCBzdXNwaWNpb3VzIHBhdHRlcm5zXG4gICAgaWYgKHRoaXMuaXNTdXNwaWNpb3VzUmVxdWVzdChyZXEpKSB7XG4gICAgICBiZWhhdmlvci5zdXNwaWNpb3VzUGF0dGVybnMrKztcbiAgICB9XG5cbiAgICAvLyBUcmFpbiBNTCBtb2RlbCBwZXJpb2RpY2FsbHlcbiAgICBpZiAoYmVoYXZpb3IucmVxdWVzdENvdW50ICUgMTAgPT09IDApIHtcbiAgICAgIHRoaXMubWxNb2RlbC50cmFpbihiZWhhdmlvciwgcmVxKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogQ2hlY2sgaWYgcmVxdWVzdCBpcyBzdXNwaWNpb3VzXG4gICAqL1xuICBwcml2YXRlIGlzU3VzcGljaW91c1JlcXVlc3QocmVxOiBhbnkpOiBib29sZWFuIHtcbiAgICBjb25zdCB1cmwgPSByZXEudXJsPy50b0xvd2VyQ2FzZSgpIHx8ICcnO1xuICAgIGNvbnN0IGhlYWRlcnMgPSByZXEuaGVhZGVycztcblxuICAgIGNvbnN0IHN1c3BpY2lvdXNQYXR0ZXJucyA9IFtcbiAgICAgICdhZG1pbicsXG4gICAgICAnd3AtbG9naW4nLFxuICAgICAgJ3BocG15YWRtaW4nLFxuICAgICAgJy5lbnYnLFxuICAgICAgJ2NvbmZpZycsXG4gICAgICAnYmFja3VwJ1xuICAgIF07XG5cbiAgICByZXR1cm4gc3VzcGljaW91c1BhdHRlcm5zLnNvbWUocGF0dGVybiA9PiB1cmwuaW5jbHVkZXMocGF0dGVybikpO1xuICB9XG59XG5cbi8qKlxuICogU2ltcGxlIE1MIE1vZGVsIGZvciBiZWhhdmlvciBhbmFseXNpc1xuICovXG5jbGFzcyBTaW1wbGVNTE1vZGVsIHtcbiAgcHJpdmF0ZSBwYXR0ZXJucyA9IG5ldyBNYXA8c3RyaW5nLCBudW1iZXI+KCk7XG5cbiAgdHJhaW4oYmVoYXZpb3I6IGFueSwgcmVxOiBhbnkpOiB2b2lkIHtcbiAgICAvLyBTaW1wbGUgcGF0dGVybiByZWNvZ25pdGlvblxuICAgIGNvbnN0IGtleSA9IGAke2JlaGF2aW9yLnJlcXVlc3RDb3VudH06JHtiZWhhdmlvci5zdXNwaWNpb3VzUGF0dGVybnN9YDtcbiAgICBjb25zdCBjdXJyZW50ID0gdGhpcy5wYXR0ZXJucy5nZXQoa2V5KSB8fCAwO1xuICAgIHRoaXMucGF0dGVybnMuc2V0KGtleSwgY3VycmVudCArIDEpO1xuICB9XG5cbiAgcHJlZGljdChiZWhhdmlvcjogYW55KTogbnVtYmVyIHtcbiAgICBjb25zdCBrZXkgPSBgJHtiZWhhdmlvci5yZXF1ZXN0Q291bnR9OiR7YmVoYXZpb3Iuc3VzcGljaW91c1BhdHRlcm5zfWA7XG4gICAgcmV0dXJuIHRoaXMucGF0dGVybnMuZ2V0KGtleSkgfHwgMDtcbiAgfVxufVxuXG4vLyBFeHBvcnQgZ2xvYmFsIGluc3RhbmNlc1xuZXhwb3J0IGNvbnN0IHJhdGVMaW1pdGVyID0gbmV3IFJhdGVMaW1pdGVyKCk7XG5leHBvcnQgY29uc3QgYWRhcHRpdmVSYXRlTGltaXRlciA9IG5ldyBBZGFwdGl2ZVJhdGVMaW1pdGVyKCk7XG5cbi8vIFByZS1jb25maWd1cmUgY29tbW9uIHJhdGUgbGltaXRzXG5yYXRlTGltaXRlci5jb25maWd1cmUoJy9hcGkvYXV0aC9sb2dpbicsIHtcbiAgd2luZG93TXM6IDE1ICogNjAgKiAxMDAwLCAvLyAxNSBtaW51dGVzXG4gIG1heFJlcXVlc3RzOiA1LFxuICBvbkxpbWl0UmVhY2hlZDogKGtleSwgbGltaXQpID0+IHtcbiAgICBjb25zb2xlLndhcm4oYExvZ2luIGxpbWl0IHJlYWNoZWQgZm9yIGtleTogJHtrZXl9YCk7XG4gIH1cbn0pO1xuXG5yYXRlTGltaXRlci5jb25maWd1cmUoJy9hcGkvYXV0aCcsIHtcbiAgd2luZG93TXM6IDYwICogNjAgKiAxMDAwLCAvLyAxIGhvdXJcbiAgbWF4UmVxdWVzdHM6IDEwLFxuICBvbkxpbWl0UmVhY2hlZDogKGtleSwgbGltaXQpID0+IHtcbiAgICBjb25zb2xlLndhcm4oYEF1dGggbGltaXQgcmVhY2hlZCBmb3Iga2V5OiAke2tleX1gKTtcbiAgfVxufSk7XG5cbnJhdGVMaW1pdGVyLmNvbmZpZ3VyZSgnL2FwaS9yb2xlcycsIHtcbiAgd2luZG93TXM6IDYwICogNjAgKiAxMDAwLCAvLyAxIGhvdXJcbiAgbWF4UmVxdWVzdHM6IDIwLFxuICBvbkxpbWl0UmVhY2hlZDogKGtleSwgbGltaXQpID0+IHtcbiAgICBjb25zb2xlLndhcm4oYFJvbGVzIGxpbWl0IHJlYWNoZWQgZm9yIGtleTogJHtrZXl9YCk7XG4gIH1cbn0pO1xuXG5yYXRlTGltaXRlci5jb25maWd1cmUoJy9hcGkvdXNlcnMnLCB7XG4gIHdpbmRvd01zOiA2MCAqIDYwICogMTAwMCwgLy8gMSBob3VyXG4gIG1heFJlcXVlc3RzOiA1MCxcbiAgb25MaW1pdFJlYWNoZWQ6IChrZXksIGxpbWl0KSA9PiB7XG4gICAgY29uc29sZS53YXJuKGBVc2VycyBsaW1pdCByZWFjaGVkIGZvciBrZXk6ICR7a2V5fWApO1xuICB9XG59KTtcblxucmF0ZUxpbWl0ZXIuY29uZmlndXJlKCcvYWRtaW4nLCB7XG4gIHdpbmRvd01zOiA2MCAqIDYwICogMTAwMCwgLy8gMSBob3VyXG4gIG1heFJlcXVlc3RzOiAzMCxcbiAgb25MaW1pdFJlYWNoZWQ6IChrZXksIGxpbWl0KSA9PiB7XG4gICAgY29uc29sZS53YXJuKGBBZG1pbiBsaW1pdCByZWFjaGVkIGZvciBrZXk6ICR7a2V5fWApO1xuICB9XG59KTsiXSwibmFtZXMiOlsiY3JlYXRlSGFzaCIsIlJhdGVMaW1pdGVyIiwiY29uc3RydWN0b3IiLCJzdG9yZXMiLCJNYXAiLCJjb25maWdzIiwibWV0cmljcyIsInRvdGFsUmVxdWVzdHMiLCJibG9ja2VkUmVxdWVzdHMiLCJzdXNwaWNpb3VzQWN0aXZpdHkiLCJhdmVyYWdlUmVzcG9uc2VUaW1lIiwidG9wQmxvY2tlZElQcyIsInRvcEVuZHBvaW50cyIsInN0YXJ0Q2xlYW51cEludGVydmFsIiwiY29uZmlndXJlIiwicGF0dGVybiIsImNvbmZpZyIsInNldCIsImNoZWNrTGltaXQiLCJyZXEiLCJzdGFydFRpbWUiLCJwZXJmb3JtYW5jZSIsIm5vdyIsImdldCIsImFsbG93ZWQiLCJrZXkiLCJrZXlHZW5lcmF0b3IiLCJkZWZhdWx0S2V5R2VuZXJhdG9yIiwic3RvcmUiLCJnZXRTdG9yZSIsIkRhdGUiLCJjbGVhbnVwRXhwaXJlZEVudHJpZXMiLCJjdXJyZW50IiwiY291bnQiLCJyZXNldFRpbWUiLCJ3aW5kb3dNcyIsImxpbWl0SW5mbyIsIm1heCIsIm1heFJlcXVlc3RzIiwicmVtYWluaW5nIiwiTWF0aCIsInJldHJ5QWZ0ZXIiLCJjZWlsIiwiaXNMaW1pdGVkIiwidXBkYXRlQmxvY2tlZElQcyIsImlwIiwidXBkYXRlQmxvY2tlZEVuZHBvaW50cyIsInVybCIsIm9uTGltaXRSZWFjaGVkIiwicmVzcG9uc2VUaW1lIiwidXBkYXRlTWV0cmljcyIsInVuZGVmaW5lZCIsImVycm9yIiwiY29uc29sZSIsImdldE1ldHJpY3MiLCJzb3J0ZWRJUHMiLCJzb3J0IiwiYSIsImIiLCJzbGljZSIsInNvcnRlZEVuZHBvaW50cyIsImJsb2NrZWQiLCJyZXNldE1ldHJpY3MiLCJoYXMiLCJ1c2VyQWdlbnQiLCJoZWFkZXJzIiwiaGFzaCIsInVwZGF0ZSIsImRpZ2VzdCIsImVudHJ5IiwiZW50cmllcyIsImRlbGV0ZSIsImVuZHBvaW50IiwiaXBFbnRyeSIsImZpbmQiLCJwIiwibGFzdEJsb2NrZWQiLCJwdXNoIiwiZW5kcG9pbnRFbnRyeSIsImUiLCJpc1N1c3BpY2lvdXNJUCIsInN1c3BpY2lvdXNQYXR0ZXJucyIsInNvbWUiLCJpbmNsdWRlcyIsImNsZWFudXBJbnRlcnZhbCIsInNldEludGVydmFsIiwic2h1dGRvd24iLCJjbGVhckludGVydmFsIiwiQWRhcHRpdmVSYXRlTGltaXRlciIsInVzZXJCZWhhdmlvciIsIm1sTW9kZWwiLCJTaW1wbGVNTE1vZGVsIiwidXNlcktleSIsImdldFVzZXJLZXkiLCJiZWhhdmlvciIsImdldFVzZXJCZWhhdmlvciIsInJpc2tTY29yZSIsImNhbGN1bGF0ZVJpc2tTY29yZSIsImFkanVzdGVkQ29uZmlnIiwiYWRqdXN0Q29uZmlnQnlSaXNrIiwic3RvcmVCZWhhdmlvciIsInRpbWVzdGFtcCIsImhvdXIiLCJmbG9vciIsInJlcXVlc3RDb3VudCIsImF2ZXJhZ2VJbnRlcnZhbCIsImxhc3RBY3Rpdml0eSIsInRydXN0ZWQiLCJzY29yZSIsInRpbWVTaW5jZUxhc3RBY3Rpdml0eSIsInRvTG93ZXJDYXNlIiwibWluIiwiYmFzZUNvbmZpZyIsIm11bHRpcGxpZXIiLCJpc1N1c3BpY2lvdXNSZXF1ZXN0IiwidHJhaW4iLCJwYXR0ZXJucyIsInByZWRpY3QiLCJyYXRlTGltaXRlciIsImFkYXB0aXZlUmF0ZUxpbWl0ZXIiLCJsaW1pdCIsIndhcm4iXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/rateLimiter.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/supabase.ts":
/*!*****************************!*\
  !*** ./src/lib/supabase.ts ***!
  \*****************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   auth: () => (/* binding */ auth),\n/* harmony export */   requireAuth: () => (/* binding */ requireAuth),\n/* harmony export */   supabase: () => (/* binding */ supabase),\n/* harmony export */   supabaseService: () => (/* binding */ supabaseService),\n/* harmony export */   useAuth: () => (/* binding */ useAuth),\n/* harmony export */   users: () => (/* binding */ users)\n/* harmony export */ });\n/* harmony import */ var _supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @supabase/supabase-js */ \"(rsc)/./node_modules/@supabase/supabase-js/dist/module/index.js\");\n\n// Configuracin del cliente Supabase\nconst supabaseUrl = \"https://bmwuxzysmznqukvnziqc.supabase.co\";\nconst supabaseAnonKey = \"sb_publishable_KGnm3YmA2wr_e__advPzow_OdOJPu9w\";\nif (!supabaseUrl || !supabaseAnonKey) {\n    throw new Error(\"Falta la configuraci\\xf3n de Supabase. Verifica las variables de entorno.\");\n}\n// Cliente para uso en componentes (publico)\nconst supabase = (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__.createClient)(supabaseUrl, supabaseAnonKey, {\n    auth: {\n        persistSession: true,\n        autoRefreshToken: true,\n        detectSessionInUrl: true\n    }\n});\n// Cliente con rol de servicio (para operaciones administrativas)\nconst supabaseService = (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__.createClient)(supabaseUrl, process.env.SUPABASE_SERVICE_ROLE_KEY || supabaseAnonKey, {\n    auth: {\n        persistSession: false,\n        autoRefreshToken: false\n    }\n});\n// Funciones de autenticacin\nconst auth = {\n    // Registrar nuevo usuario\n    signUp: async (email, password, name)=>{\n        const { data, error } = await supabase.auth.signUp({\n            email,\n            password,\n            options: {\n                data: {\n                    name,\n                    role: \"user\"\n                }\n            }\n        });\n        return {\n            data,\n            error\n        };\n    },\n    // Iniciar sesin\n    signIn: async (email, password)=>{\n        const { data, error } = await supabase.auth.signInWithPassword({\n            email,\n            password\n        });\n        return {\n            data,\n            error\n        };\n    },\n    // Iniciar sesin con OAuth\n    signInWithOAuth: async (provider)=>{\n        const { data, error } = await supabase.auth.signInWithOAuth({\n            provider,\n            options: {\n                redirectTo: `${window.location.origin}/auth/callback`\n            }\n        });\n        return {\n            data,\n            error\n        };\n    },\n    // Cerrar sesin\n    signOut: async ()=>{\n        const { error } = await supabase.auth.signOut();\n        return {\n            error\n        };\n    },\n    // Obtener usuario actual\n    getCurrentUser: async ()=>{\n        const { data: { user }, error } = await supabase.auth.getUser();\n        return {\n            user,\n            error\n        };\n    },\n    // Obtener sesin actual\n    getSession: async ()=>{\n        const { data: { session }, error } = await supabase.auth.getSession();\n        return {\n            session,\n            error\n        };\n    },\n    // Escuchar cambios de estado de autenticacin\n    onAuthStateChange: (callback)=>{\n        return supabase.auth.onAuthStateChange(callback);\n    },\n    // Actualizar perfil de usuario\n    updateProfile: async (updates)=>{\n        const { error } = await supabase.auth.updateUser(updates);\n        return {\n            error\n        };\n    },\n    // Cambiar contrasea\n    updatePassword: async (newPassword)=>{\n        const { error } = await supabase.auth.updateUser({\n            password: newPassword\n        });\n        return {\n            error\n        };\n    },\n    // Restablecer contrasea\n    resetPassword: async (email)=>{\n        const { error } = await supabase.auth.resetPasswordForEmail(email, {\n            redirectTo: `${window.location.origin}/login?reset=true`\n        });\n        return {\n            error\n        };\n    },\n    // Verificar sesin con RLS\n    verifySession: async ()=>{\n        try {\n            const { data: { user }, error } = await supabase.auth.getUser();\n            if (error || !user) {\n                return {\n                    valid: false,\n                    error\n                };\n            }\n            // Verificar que el usuario existe en la tabla users\n            const { data: userData, error: userError } = await supabase.from(\"users\").select(\"id, email, role, status\").eq(\"id\", user.id).single();\n            if (userError || !userData || userData.status !== \"active\") {\n                return {\n                    valid: false,\n                    error: userError || new Error(\"Usuario no activo\")\n                };\n            }\n            return {\n                valid: true,\n                user: {\n                    ...user,\n                    role: userData.role\n                }\n            };\n        } catch (error) {\n            return {\n                valid: false,\n                error\n            };\n        }\n    }\n};\n// Funciones de usuario\nconst users = {\n    // Obtener datos completos del usuario\n    getUserData: async (userId)=>{\n        const targetUserId = userId || (await auth.getCurrentUser()).user?.id;\n        if (!targetUserId) return {\n            data: null,\n            error: new Error(\"Usuario no autenticado\")\n        };\n        const { data, error } = await supabase.from(\"users\").select(`\n        id,\n        email,\n        name,\n        role,\n        avatar,\n        created_at,\n        updated_at,\n        profile: profiles(*),\n        last_login\n      `).eq(\"id\", targetUserId).single();\n        return {\n            data,\n            error\n        };\n    },\n    // Actualizar rol de usuario (solo para admin)\n    updateUserRole: async (userId, role)=>{\n        const { data, error } = await supabaseService.from(\"users\").update({\n            role,\n            updated_at: new Date().toISOString()\n        }).eq(\"id\", userId).select().single();\n        return {\n            data,\n            error\n        };\n    },\n    // Obtener todos los usuarios (solo para admin)\n    getAllUsers: async (page = 1, limit = 20)=>{\n        const offset = (page - 1) * limit;\n        const { data, error, count } = await supabaseService.from(\"users\").select(\"id, email, name, role, status, created_at, last_login\", {\n            count: \"exact\"\n        }).order(\"created_at\", {\n            ascending: false\n        }).range(offset, offset + limit - 1);\n        return {\n            data,\n            error,\n            count\n        };\n    },\n    // Auditora de cambios\n    getAuditLog: async (userId, limit = 100)=>{\n        let query = supabaseService.from(\"audit_logs\").select(\"*\").order(\"created_at\", {\n            ascending: false\n        }).limit(limit);\n        if (userId) {\n            query = query.eq(\"user_id\", userId);\n        }\n        const { data, error } = await query;\n        return {\n            data,\n            error\n        };\n    }\n};\n// Middleware de autenticacin\nconst requireAuth = async (requiredRole)=>{\n    const { valid, user, error } = await auth.verifySession();\n    if (!valid || !user) {\n        return {\n            authorized: false,\n            error: error || new Error(\"Sesi\\xf3n no v\\xe1lida\")\n        };\n    }\n    if (requiredRole && user.role !== requiredRole && user.role !== \"super_admin\") {\n        return {\n            authorized: false,\n            error: new Error(`Se requiere rol ${requiredRole} o superior`)\n        };\n    }\n    return {\n        authorized: true,\n        user\n    };\n};\n// Hook de autenticacin para componentes\nconst useAuth = ()=>{\n    return {\n        supabase,\n        auth,\n        users,\n        requireAuth\n    };\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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Oi8vbm90aS1lc2V0Ly4vc3JjL2xpYi9zdXBhYmFzZS50cz8wNmUxIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGNyZWF0ZUNsaWVudCwgU3VwYWJhc2VDbGllbnQgfSBmcm9tICdAc3VwYWJhc2Uvc3VwYWJhc2UtanMnXG5cbi8vIENvbmZpZ3VyYWNpw7NuIGRlbCBjbGllbnRlIFN1cGFiYXNlXG5jb25zdCBzdXBhYmFzZVVybCA9IHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX1NVUEFCQVNFX1VSTCFcbmNvbnN0IHN1cGFiYXNlQW5vbktleSA9IHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX1NVUEFCQVNFX0FOT05fS0VZIVxuXG5pZiAoIXN1cGFiYXNlVXJsIHx8ICFzdXBhYmFzZUFub25LZXkpIHtcbiAgdGhyb3cgbmV3IEVycm9yKCdGYWx0YSBsYSBjb25maWd1cmFjacOzbiBkZSBTdXBhYmFzZS4gVmVyaWZpY2EgbGFzIHZhcmlhYmxlcyBkZSBlbnRvcm5vLicpXG59XG5cbi8vIENsaWVudGUgcGFyYSB1c28gZW4gY29tcG9uZW50ZXMgKHB1YmxpY28pXG5leHBvcnQgY29uc3Qgc3VwYWJhc2U6IFN1cGFiYXNlQ2xpZW50ID0gY3JlYXRlQ2xpZW50KHN1cGFiYXNlVXJsLCBzdXBhYmFzZUFub25LZXksIHtcbiAgYXV0aDoge1xuICAgIHBlcnNpc3RTZXNzaW9uOiB0cnVlLFxuICAgIGF1dG9SZWZyZXNoVG9rZW46IHRydWUsXG4gICAgZGV0ZWN0U2Vzc2lvbkluVXJsOiB0cnVlLFxuICB9LFxufSlcblxuLy8gQ2xpZW50ZSBjb24gcm9sIGRlIHNlcnZpY2lvIChwYXJhIG9wZXJhY2lvbmVzIGFkbWluaXN0cmF0aXZhcylcbmV4cG9ydCBjb25zdCBzdXBhYmFzZVNlcnZpY2UgPSBjcmVhdGVDbGllbnQoXG4gIHN1cGFiYXNlVXJsLFxuICBwcm9jZXNzLmVudi5TVVBBQkFTRV9TRVJWSUNFX1JPTEVfS0VZIHx8IHN1cGFiYXNlQW5vbktleSxcbiAge1xuICAgIGF1dGg6IHtcbiAgICAgIHBlcnNpc3RTZXNzaW9uOiBmYWxzZSwgLy8gTm8gcGVyc2lzdGlyIHNlc2nDs24gcGFyYSBvcGVyYWNpb25lcyBkZSBzZXJ2aWNpb1xuICAgICAgYXV0b1JlZnJlc2hUb2tlbjogZmFsc2UsXG4gICAgfSxcbiAgfVxuKVxuXG4vLyBUaXBvcyBwZXJzb25hbGl6YWRvcyBwYXJhIGF1dGVudGljYWNpw7NuXG5leHBvcnQgdHlwZSBVc2VyID0ge1xuICBpZDogc3RyaW5nXG4gIGVtYWlsOiBzdHJpbmdcbiAgbmFtZT86IHN0cmluZ1xuICByb2xlOiAndXNlcicgfCAnZWRpdG9yJyB8ICdhZG1pbicgfCAnc3VwZXJfYWRtaW4nXG4gIGF2YXRhcj86IHN0cmluZ1xuICBjcmVhdGVkX2F0OiBzdHJpbmdcbiAgdXBkYXRlZF9hdDogc3RyaW5nXG59XG5cbmV4cG9ydCB0eXBlIEF1dGhTZXNzaW9uID0ge1xuICBhY2Nlc3NfdG9rZW46IHN0cmluZ1xuICByZWZyZXNoX3Rva2VuOiBzdHJpbmdcbiAgZXhwaXJlc19hdDogbnVtYmVyXG4gIHVzZXI6IFVzZXJcbn1cblxuLy8gRnVuY2lvbmVzIGRlIGF1dGVudGljYWNpw7NuXG5leHBvcnQgY29uc3QgYXV0aCA9IHtcbiAgLy8gUmVnaXN0cmFyIG51ZXZvIHVzdWFyaW9cbiAgc2lnblVwOiBhc3luYyAoZW1haWw6IHN0cmluZywgcGFzc3dvcmQ6IHN0cmluZywgbmFtZT86IHN0cmluZykgPT4ge1xuICAgIGNvbnN0IHsgZGF0YSwgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlLmF1dGguc2lnblVwKHtcbiAgICAgIGVtYWlsLFxuICAgICAgcGFzc3dvcmQsXG4gICAgICBvcHRpb25zOiB7XG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICBuYW1lLFxuICAgICAgICAgIHJvbGU6ICd1c2VyJywgLy8gUm9sIHBvciBkZWZlY3RvXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgIH0pXG4gICAgcmV0dXJuIHsgZGF0YSwgZXJyb3IgfVxuICB9LFxuXG4gIC8vIEluaWNpYXIgc2VzacOzblxuICBzaWduSW46IGFzeW5jIChlbWFpbDogc3RyaW5nLCBwYXNzd29yZDogc3RyaW5nKSA9PiB7XG4gICAgY29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2UuYXV0aC5zaWduSW5XaXRoUGFzc3dvcmQoe1xuICAgICAgZW1haWwsXG4gICAgICBwYXNzd29yZCxcbiAgICB9KVxuICAgIHJldHVybiB7IGRhdGEsIGVycm9yIH1cbiAgfSxcblxuICAvLyBJbmljaWFyIHNlc2nDs24gY29uIE9BdXRoXG4gIHNpZ25JbldpdGhPQXV0aDogYXN5bmMgKHByb3ZpZGVyOiAnZ29vZ2xlJyB8ICdnaXRodWInKSA9PiB7XG4gICAgY29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2UuYXV0aC5zaWduSW5XaXRoT0F1dGgoe1xuICAgICAgcHJvdmlkZXIsXG4gICAgICBvcHRpb25zOiB7XG4gICAgICAgIHJlZGlyZWN0VG86IGAke3dpbmRvdy5sb2NhdGlvbi5vcmlnaW59L2F1dGgvY2FsbGJhY2tgXG4gICAgICB9XG4gICAgfSlcbiAgICByZXR1cm4geyBkYXRhLCBlcnJvciB9XG4gIH0sXG5cbiAgLy8gQ2VycmFyIHNlc2nDs25cbiAgc2lnbk91dDogYXN5bmMgKCkgPT4ge1xuICAgIGNvbnN0IHsgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlLmF1dGguc2lnbk91dCgpXG4gICAgcmV0dXJuIHsgZXJyb3IgfVxuICB9LFxuXG4gIC8vIE9idGVuZXIgdXN1YXJpbyBhY3R1YWxcbiAgZ2V0Q3VycmVudFVzZXI6IGFzeW5jICgpID0+IHtcbiAgICBjb25zdCB7IGRhdGE6IHsgdXNlciB9LCBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2UuYXV0aC5nZXRVc2VyKClcbiAgICByZXR1cm4geyB1c2VyLCBlcnJvciB9XG4gIH0sXG5cbiAgLy8gT2J0ZW5lciBzZXNpw7NuIGFjdHVhbFxuICBnZXRTZXNzaW9uOiBhc3luYyAoKSA9PiB7XG4gICAgY29uc3QgeyBkYXRhOiB7IHNlc3Npb24gfSwgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlLmF1dGguZ2V0U2Vzc2lvbigpXG4gICAgcmV0dXJuIHsgc2Vzc2lvbiwgZXJyb3IgfVxuICB9LFxuXG4gIC8vIEVzY3VjaGFyIGNhbWJpb3MgZGUgZXN0YWRvIGRlIGF1dGVudGljYWNpw7NuXG4gIG9uQXV0aFN0YXRlQ2hhbmdlOiAoY2FsbGJhY2s6IChldmVudDogc3RyaW5nLCBzZXNzaW9uOiBhbnkpID0+IHZvaWQpID0+IHtcbiAgICByZXR1cm4gc3VwYWJhc2UuYXV0aC5vbkF1dGhTdGF0ZUNoYW5nZShjYWxsYmFjaylcbiAgfSxcblxuICAvLyBBY3R1YWxpemFyIHBlcmZpbCBkZSB1c3VhcmlvXG4gIHVwZGF0ZVByb2ZpbGU6IGFzeW5jICh1cGRhdGVzOiB7IG5hbWU/OiBzdHJpbmc7IGF2YXRhcj86IHN0cmluZyB9KSA9PiB7XG4gICAgY29uc3QgeyBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2UuYXV0aC51cGRhdGVVc2VyKHVwZGF0ZXMpXG4gICAgcmV0dXJuIHsgZXJyb3IgfVxuICB9LFxuXG4gIC8vIENhbWJpYXIgY29udHJhc2XDsWFcbiAgdXBkYXRlUGFzc3dvcmQ6IGFzeW5jIChuZXdQYXNzd29yZDogc3RyaW5nKSA9PiB7XG4gICAgY29uc3QgeyBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2UuYXV0aC51cGRhdGVVc2VyKHtcbiAgICAgIHBhc3N3b3JkOiBuZXdQYXNzd29yZCxcbiAgICB9KVxuICAgIHJldHVybiB7IGVycm9yIH1cbiAgfSxcblxuICAvLyBSZXN0YWJsZWNlciBjb250cmFzZcOxYVxuICByZXNldFBhc3N3b3JkOiBhc3luYyAoZW1haWw6IHN0cmluZykgPT4ge1xuICAgIGNvbnN0IHsgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlLmF1dGgucmVzZXRQYXNzd29yZEZvckVtYWlsKGVtYWlsLCB7XG4gICAgICByZWRpcmVjdFRvOiBgJHt3aW5kb3cubG9jYXRpb24ub3JpZ2lufS9sb2dpbj9yZXNldD10cnVlYCxcbiAgICB9KVxuICAgIHJldHVybiB7IGVycm9yIH1cbiAgfSxcblxuICAvLyBWZXJpZmljYXIgc2VzacOzbiBjb24gUkxTXG4gIHZlcmlmeVNlc3Npb246IGFzeW5jICgpID0+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgeyBkYXRhOiB7IHVzZXIgfSwgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlLmF1dGguZ2V0VXNlcigpXG5cbiAgICAgIGlmIChlcnJvciB8fCAhdXNlcikge1xuICAgICAgICByZXR1cm4geyB2YWxpZDogZmFsc2UsIGVycm9yIH1cbiAgICAgIH1cblxuICAgICAgLy8gVmVyaWZpY2FyIHF1ZSBlbCB1c3VhcmlvIGV4aXN0ZSBlbiBsYSB0YWJsYSB1c2Vyc1xuICAgICAgY29uc3QgeyBkYXRhOiB1c2VyRGF0YSwgZXJyb3I6IHVzZXJFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcbiAgICAgICAgLmZyb20oJ3VzZXJzJylcbiAgICAgICAgLnNlbGVjdCgnaWQsIGVtYWlsLCByb2xlLCBzdGF0dXMnKVxuICAgICAgICAuZXEoJ2lkJywgdXNlci5pZClcbiAgICAgICAgLnNpbmdsZSgpXG5cbiAgICAgIGlmICh1c2VyRXJyb3IgfHwgIXVzZXJEYXRhIHx8IHVzZXJEYXRhLnN0YXR1cyAhPT0gJ2FjdGl2ZScpIHtcbiAgICAgICAgcmV0dXJuIHsgdmFsaWQ6IGZhbHNlLCBlcnJvcjogdXNlckVycm9yIHx8IG5ldyBFcnJvcignVXN1YXJpbyBubyBhY3Rpdm8nKSB9XG4gICAgICB9XG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIHZhbGlkOiB0cnVlLFxuICAgICAgICB1c2VyOiB7IC4uLnVzZXIsIHJvbGU6IHVzZXJEYXRhLnJvbGUgfVxuICAgICAgfVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICByZXR1cm4geyB2YWxpZDogZmFsc2UsIGVycm9yIH1cbiAgICB9XG4gIH0sXG59XG5cbi8vIEZ1bmNpb25lcyBkZSB1c3VhcmlvXG5leHBvcnQgY29uc3QgdXNlcnMgPSB7XG4gIC8vIE9idGVuZXIgZGF0b3MgY29tcGxldG9zIGRlbCB1c3VhcmlvXG4gIGdldFVzZXJEYXRhOiBhc3luYyAodXNlcklkPzogc3RyaW5nKSA9PiB7XG4gICAgY29uc3QgdGFyZ2V0VXNlcklkID0gdXNlcklkIHx8IChhd2FpdCBhdXRoLmdldEN1cnJlbnRVc2VyKCkpLnVzZXI/LmlkXG4gICAgaWYgKCF0YXJnZXRVc2VySWQpIHJldHVybiB7IGRhdGE6IG51bGwsIGVycm9yOiBuZXcgRXJyb3IoJ1VzdWFyaW8gbm8gYXV0ZW50aWNhZG8nKSB9XG5cbiAgICBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxuICAgICAgLmZyb20oJ3VzZXJzJylcbiAgICAgIC5zZWxlY3QoYFxuICAgICAgICBpZCxcbiAgICAgICAgZW1haWwsXG4gICAgICAgIG5hbWUsXG4gICAgICAgIHJvbGUsXG4gICAgICAgIGF2YXRhcixcbiAgICAgICAgY3JlYXRlZF9hdCxcbiAgICAgICAgdXBkYXRlZF9hdCxcbiAgICAgICAgcHJvZmlsZTogcHJvZmlsZXMoKiksXG4gICAgICAgIGxhc3RfbG9naW5cbiAgICAgIGApXG4gICAgICAuZXEoJ2lkJywgdGFyZ2V0VXNlcklkKVxuICAgICAgLnNpbmdsZSgpXG5cbiAgICByZXR1cm4geyBkYXRhLCBlcnJvciB9XG4gIH0sXG5cbiAgLy8gQWN0dWFsaXphciByb2wgZGUgdXN1YXJpbyAoc29sbyBwYXJhIGFkbWluKVxuICB1cGRhdGVVc2VyUm9sZTogYXN5bmMgKHVzZXJJZDogc3RyaW5nLCByb2xlOiAndXNlcicgfCAnZWRpdG9yJyB8ICdhZG1pbicgfCAnc3VwZXJfYWRtaW4nKSA9PiB7XG4gICAgY29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VTZXJ2aWNlXG4gICAgICAuZnJvbSgndXNlcnMnKVxuICAgICAgLnVwZGF0ZSh7XG4gICAgICAgIHJvbGUsXG4gICAgICAgIHVwZGF0ZWRfYXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKVxuICAgICAgfSlcbiAgICAgIC5lcSgnaWQnLCB1c2VySWQpXG4gICAgICAuc2VsZWN0KClcbiAgICAgIC5zaW5nbGUoKVxuXG4gICAgcmV0dXJuIHsgZGF0YSwgZXJyb3IgfVxuICB9LFxuXG4gIC8vIE9idGVuZXIgdG9kb3MgbG9zIHVzdWFyaW9zIChzb2xvIHBhcmEgYWRtaW4pXG4gIGdldEFsbFVzZXJzOiBhc3luYyAocGFnZSA9IDEsIGxpbWl0ID0gMjApID0+IHtcbiAgICBjb25zdCBvZmZzZXQgPSAocGFnZSAtIDEpICogbGltaXRcblxuICAgIGNvbnN0IHsgZGF0YSwgZXJyb3IsIGNvdW50IH0gPSBhd2FpdCBzdXBhYmFzZVNlcnZpY2VcbiAgICAgIC5mcm9tKCd1c2VycycpXG4gICAgICAuc2VsZWN0KCdpZCwgZW1haWwsIG5hbWUsIHJvbGUsIHN0YXR1cywgY3JlYXRlZF9hdCwgbGFzdF9sb2dpbicsIHsgY291bnQ6ICdleGFjdCcgfSlcbiAgICAgIC5vcmRlcignY3JlYXRlZF9hdCcsIHsgYXNjZW5kaW5nOiBmYWxzZSB9KVxuICAgICAgLnJhbmdlKG9mZnNldCwgb2Zmc2V0ICsgbGltaXQgLSAxKVxuXG4gICAgcmV0dXJuIHsgZGF0YSwgZXJyb3IsIGNvdW50IH1cbiAgfSxcblxuICAvLyBBdWRpdG9yw61hIGRlIGNhbWJpb3NcbiAgZ2V0QXVkaXRMb2c6IGFzeW5jICh1c2VySWQ/OiBzdHJpbmcsIGxpbWl0ID0gMTAwKSA9PiB7XG4gICAgbGV0IHF1ZXJ5ID0gc3VwYWJhc2VTZXJ2aWNlXG4gICAgICAuZnJvbSgnYXVkaXRfbG9ncycpXG4gICAgICAuc2VsZWN0KCcqJylcbiAgICAgIC5vcmRlcignY3JlYXRlZF9hdCcsIHsgYXNjZW5kaW5nOiBmYWxzZSB9KVxuICAgICAgLmxpbWl0KGxpbWl0KVxuXG4gICAgaWYgKHVzZXJJZCkge1xuICAgICAgcXVlcnkgPSBxdWVyeS5lcSgndXNlcl9pZCcsIHVzZXJJZClcbiAgICB9XG5cbiAgICBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCBxdWVyeVxuICAgIHJldHVybiB7IGRhdGEsIGVycm9yIH1cbiAgfSxcbn1cblxuLy8gTWlkZGxld2FyZSBkZSBhdXRlbnRpY2FjacOzblxuZXhwb3J0IGNvbnN0IHJlcXVpcmVBdXRoID0gYXN5bmMgKHJlcXVpcmVkUm9sZT86IFVzZXJbJ3JvbGUnXSkgPT4ge1xuICBjb25zdCB7IHZhbGlkLCB1c2VyLCBlcnJvciB9ID0gYXdhaXQgYXV0aC52ZXJpZnlTZXNzaW9uKClcblxuICBpZiAoIXZhbGlkIHx8ICF1c2VyKSB7XG4gICAgcmV0dXJuIHsgYXV0aG9yaXplZDogZmFsc2UsIGVycm9yOiBlcnJvciB8fCBuZXcgRXJyb3IoJ1Nlc2nDs24gbm8gdsOhbGlkYScpIH1cbiAgfVxuXG4gIGlmIChyZXF1aXJlZFJvbGUgJiYgdXNlci5yb2xlICE9PSByZXF1aXJlZFJvbGUgJiYgdXNlci5yb2xlICE9PSAnc3VwZXJfYWRtaW4nKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGF1dGhvcml6ZWQ6IGZhbHNlLFxuICAgICAgZXJyb3I6IG5ldyBFcnJvcihgU2UgcmVxdWllcmUgcm9sICR7cmVxdWlyZWRSb2xlfSBvIHN1cGVyaW9yYClcbiAgICB9XG4gIH1cblxuICByZXR1cm4geyBhdXRob3JpemVkOiB0cnVlLCB1c2VyIH1cbn1cblxuLy8gSG9vayBkZSBhdXRlbnRpY2FjacOzbiBwYXJhIGNvbXBvbmVudGVzXG5leHBvcnQgY29uc3QgdXNlQXV0aCA9ICgpID0+IHtcbiAgcmV0dXJuIHtcbiAgICBzdXBhYmFzZSxcbiAgICBhdXRoLFxuICAgIHVzZXJzLFxuICAgIHJlcXVpcmVBdXRoLFxuICB9XG59Il0sIm5hbWVzIjpbImNyZWF0ZUNsaWVudCIsInN1cGFiYXNlVXJsIiwicHJvY2VzcyIsImVudiIsIk5FWFRfUFVCTElDX1NVUEFCQVNFX1VSTCIsInN1cGFiYXNlQW5vbktleSIsIk5FWFRfUFVCTElDX1NVUEFCQVNFX0FOT05fS0VZIiwiRXJyb3IiLCJzdXBhYmFzZSIsImF1dGgiLCJwZXJzaXN0U2Vzc2lvbiIsImF1dG9SZWZyZXNoVG9rZW4iLCJkZXRlY3RTZXNzaW9uSW5VcmwiLCJzdXBhYmFzZVNlcnZpY2UiLCJTVVBBQkFTRV9TRVJWSUNFX1JPTEVfS0VZIiwic2lnblVwIiwiZW1haWwiLCJwYXNzd29yZCIsIm5hbWUiLCJkYXRhIiwiZXJyb3IiLCJvcHRpb25zIiwicm9sZSIsInNpZ25JbiIsInNpZ25JbldpdGhQYXNzd29yZCIsInNpZ25JbldpdGhPQXV0aCIsInByb3ZpZGVyIiwicmVkaXJlY3RUbyIsIndpbmRvdyIsImxvY2F0aW9uIiwib3JpZ2luIiwic2lnbk91dCIsImdldEN1cnJlbnRVc2VyIiwidXNlciIsImdldFVzZXIiLCJnZXRTZXNzaW9uIiwic2Vzc2lvbiIsIm9uQXV0aFN0YXRlQ2hhbmdlIiwiY2FsbGJhY2siLCJ1cGRhdGVQcm9maWxlIiwidXBkYXRlcyIsInVwZGF0ZVVzZXIiLCJ1cGRhdGVQYXNzd29yZCIsIm5ld1Bhc3N3b3JkIiwicmVzZXRQYXNzd29yZCIsInJlc2V0UGFzc3dvcmRGb3JFbWFpbCIsInZlcmlmeVNlc3Npb24iLCJ2YWxpZCIsInVzZXJEYXRhIiwidXNlckVycm9yIiwiZnJvbSIsInNlbGVjdCIsImVxIiwiaWQiLCJzaW5nbGUiLCJzdGF0dXMiLCJ1c2VycyIsImdldFVzZXJEYXRhIiwidXNlcklkIiwidGFyZ2V0VXNlcklkIiwidXBkYXRlVXNlclJvbGUiLCJ1cGRhdGUiLCJ1cGRhdGVkX2F0IiwiRGF0ZSIsInRvSVNPU3RyaW5nIiwiZ2V0QWxsVXNlcnMiLCJwYWdlIiwibGltaXQiLCJvZmZzZXQiLCJjb3VudCIsIm9yZGVyIiwiYXNjZW5kaW5nIiwicmFuZ2UiLCJnZXRBdWRpdExvZyIsInF1ZXJ5IiwicmVxdWlyZUF1dGgiLCJyZXF1aXJlZFJvbGUiLCJhdXRob3JpemVkIiwidXNlQXV0aCJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/supabase.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next","vendor-chunks/@supabase","vendor-chunks/tslib","vendor-chunks/iceberg-js","vendor-chunks/zod"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fnews%2Froute&page=%2Fapi%2Fnews%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fnews%2Froute.ts&appDir=%2Fhome%2Fsamuel%2FEscritorio%2FNoti-ESET%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2Fhome%2Fsamuel%2FEscritorio%2FNoti-ESET&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=standalone&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();